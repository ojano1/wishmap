/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var kt=Object.defineProperty;var Re=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var We=Object.prototype.hasOwnProperty;var Be=(t,e)=>{for(var n in e)kt(t,n,{get:e[n],enumerable:!0})},Ie=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ne(e))!We.call(t,o)&&o!==n&&kt(t,o,{get:()=>e[o],enumerable:!(a=Re(e,o))||a.enumerable});return t};var Ge=t=>Ie(kt({},"__esModule",{value:!0}),t);var Da={};Be(Da,{default:()=>bt});module.exports=Ge(Da);var F=require("obsidian");var It=require("obsidian");var tt=require("obsidian");function Ke(t,e,n){let a=t.metadataCache.getFileCache(e);if(!a?.headings)return null;let o=u=>u.trim().toLowerCase(),s=o(n),r=a.headings.sort((u,d)=>u.position.start.line-d.position.start.line),l=r.findIndex(u=>o(u.heading)===s);if(l===-1)return null;let i=r[l].position.end.line+1,c=l<r.length-1?r[l+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:i,endLine:c}}async function Bt(t,e,n,a){let o=Ke(t,e,n);if(!o)return!1;let r=(await t.vault.read(e)).split(`
`),l=Math.min(o.startLine,r.length-1),i=Math.min(o.endLine,r.length-1),c=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let u=l;u<=i;u++){let d=r[u].match(c);if(!d)continue;let g=`- [${d[1]==="x"||d[1]==="X"?"x":" "}] ${a}`;return r[u]!==g&&(r[u]=g,await t.vault.modify(e,r.join(`
`))),!0}return!1}function j(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function qe(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function Ue(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function ze(t=new Date){return t.getFullYear()}function Xe(t=new Date){return Math.floor(t.getMonth()/3)+1}function Qe(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+n)/864e5+1)/7)}function Tt(t,e,n=new Date){let a=j(n),o=t;return o=o.replace(/{{\s*title\s*}}/gi,e),o=o.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,s=>a),o=o.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),o=o.replace(/{{\s*weekday\s*}}/gi,qe(n)),o=o.replace(/{{\s*monthShort\s*}}/gi,Ue(n)),o=o.replace(/{{\s*year\s*}}/gi,String(ze(n))),o=o.replace(/{{\s*isoWeek\s*}}/gi,String(Qe(n))),o=o.replace(/{{\s*quarter\s*}}/gi,String(Xe(n))),o}function Ve(t,e){let n=(0,tt.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function lt(t,e){let n=(0,tt.normalizePath)(e).split("/"),a="";for(let o of n)a=a?`${a}/${o}`:o,t.vault.getAbstractFileByPath(a)||await t.vault.createFolder(a)}async function D(t,e,n){let a=(0,tt.normalizePath)(e);if(!Ve(t,a)){let s=a.split("/").slice(0,-1).join("/");s&&await lt(t,s),await t.vault.create(a,n)}}var ut=require("obsidian");var C="03 SaveBox/Templates",xt={area:`${C}/Area Template.md`,wish:`${C}/Wish Template.md`,goal:`${C}/Goal Template.md`,project:`${C}/Project Template.md`,task:`${C}/Task Template.md`,habit:`${C}/Habit Template.md`,note:`${C}/Note Template.md`,daily:`${C}/Daily Template.md`,weekly:`${C}/Weekly Template.md`,monthly:`${C}/Monthly Template.md`,quarterly:`${C}/Quarterly Template.md`,yearly:`${C}/Yearly Template.md`},Ft={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function dt(t,e,n,a=new Date){let o=(0,ut.normalizePath)(xt[e]),s=t.vault.getAbstractFileByPath(o);if(s instanceof ut.TFile){console.log(`[MMOS] Using VAULT template for ${e}: ${o}`);let r=await t.vault.read(s);return Tt(r,n,a)}return console.log(`[MMOS] Using FALLBACK template for ${e}`),Tt(Ft[e],n,a)}async function Gt(t,e){let{kind:n,title:a}=e,o=e.path??Ze(n,a),s=o.substring(0,o.lastIndexOf("/"));s&&await lt(t,s);let r=await dt(t,n,a,new Date),l=await t.vault.create(o,r);return await t.fileManager.processFrontMatter(l,i=>{i.created??(i.created=j(new Date)),n==="task"?(i.status??(i.status="Active"),i.impact??(i.impact="Med"),i.slot??(i.slot="Morning"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(i.status??(i.status="Active"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):(n==="area"||n==="note")&&(i.status??(i.status="Active"))}),l}async function Kt(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of e)await lt(t,n);await D(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await D(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await D(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await D(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await D(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,a]of Object.entries(xt))await D(t,a,Ft[n]);await D(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${j(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await D(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${j(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await D(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${j(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await D(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${j(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await D(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new It.Notice("\u2705 MindMap OS: starter structure updated.")}function Ze(t,e){let n=tn(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${Je(t)}${n}.md`}}function Je(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";default:return""}}function tn(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var et=require("obsidian");var en=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],nn={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function an(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function on(t,e){let a=new RegExp(`^#{1,6}\\s+${an(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${s}}\\s+`,"gim");r.lastIndex=o;let l=r.exec(t);return{start:o,end:l?l.index:t.length}}function sn(t,e){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=t.slice(e.start,e.end);n.lastIndex=0;let o=n.exec(a);if(!o)return null;let s=e.start+o.index,r=s+o[0].length,l=/\[(x|X)\]/.test(o[0]);return{absStart:s,absEnd:r,line:o[0],checked:l}}async function rn(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(o=>setTimeout(o,40))}}async function cn(t,e,n,a){await rn(t,e);let o=await t.vault.read(e),s=on(o,n);if(!s)return!1;let r=sn(o,s);if(!r)return!1;let i=`- [${/\[(x|X)\]/.test(r.line)?"x":" "}] ${a}`;if(r.line.trimEnd()===i)return!0;let c=o.slice(0,r.absStart)+i+o.slice(r.absEnd);return c!==o&&await t.vault.modify(e,c),!0}function ln(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}function un(t){return t instanceof et.TFile&&t.extension.toLowerCase()==="md"}function dn(t){let e=t.match(/^(\w+)\s*(?:[-â€“]\s*|\s+)(.+)$/i);if(!e)return null;let n=e[1].toLowerCase();if(!en.includes(n))return null;let a=e[2].trim();return{kind:n,title:a}}function hn(t,e){let n=fn(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${nn[t]}${n}.md`}}function fn(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function mn(t,e,n){await t.fileManager.processFrontMatter(e,a=>{a.created??(a.created=j(new Date)),n==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):n==="goal"||n==="project"||n==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):(n==="area"||n==="note")&&(a.status??(a.status="Active"))})}function qt(t){t.vault.on("create",async e=>{try{if(!un(e)||(await t.vault.read(e)).trim().length>0)return;let a=e.basename,o=dn(a);if(!o)return;let{kind:s,title:r}=o,l=await dt(t,s,r,new Date);await t.vault.modify(e,l),await mn(t,e,s);let i=(0,et.normalizePath)(hn(s,r));if(i!==e.path&&await t.fileManager.renameFile(e,i),s==="task"||s==="project"||s==="goal"){let c=t.vault.getAbstractFileByPath(i),u=c instanceof et.TFile?c:e,d=ln(s),m=u.basename;await cn(t,u,d,m)}console.log(`[MMOS] wikilink routed \u2192 ${s} | ${r}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var zt=require("obsidian");function pn(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gn(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function Xt(t,e){let a=new RegExp(`^#{1,6}\\s+${pn(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${s}}\\s+`,"gim");r.lastIndex=o;let l=r.exec(t);return{start:o,end:l?l.index:t.length}}var Ut=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function Qt(t,e){let n=t.slice(e.start,e.end);Ut.lastIndex=0;let a=Ut.exec(n);if(!a)return null;let o=e.start+a.index,s=o+a[0].length,r=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:s,line:a[0],checked:r}}function Vt(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var yn=2e3;function wn(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function bn(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function kn(t){return/<%[\s\S]*?%>/.test(t)}function Tn(t){let e=t?.stat?.ctime??0;return Date.now()-e<yn}function Zt(t,e){let n=new Set,a=t.vault.on("modify",c=>{n.has(c.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),o=c=>{let u=t.workspace.getActiveViewOfType(zt.MarkdownView),m=!!u&&u.file?.path===c.path&&u?.getMode()!=="preview";return{editor:u?.editor,inEdit:m}},s=async(c,u)=>{n.add(c.path);try{await t.fileManager.processFrontMatter(c,d=>{for(let m of Object.keys(u))d[m]=u[m]})}finally{n.delete(c.path)}},r=async(c,u,d,m,g)=>{let{editor:f,inEdit:h}=o(c);n.add(c.path);try{if(h&&f){let p=f.offsetToPos(d),k=f.offsetToPos(m);await new Promise(requestAnimationFrame),f.replaceRange(g,p,k)}else{let p=u.slice(0,d)+g+u.slice(m);p!==u&&await t.vault.modify(c,p)}}finally{n.delete(c.path)}},i=gn(async()=>{let c=t.workspace.getActiveFile();if(!c||e?.(c)||wn(c.path))return;let d=(t.metadataCache.getFileCache(c)??{}).frontmatter??{};if(bn(d))return;let{editor:m,inEdit:g}=o(c),f=g&&m?m.getValue():await t.vault.read(c);if(!f||kn(f)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(f)||Tn(c)||n.has(c.path))return;let p=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let k of p){let T=Xt(f,k.heading);if(!T)continue;let b=Qt(f,T);if(!b)continue;let $=typeof d.done=="boolean"?d.done:null,N=typeof d[k.flag]=="boolean"?d[k.flag]:null,W=b.checked;if(N===null){await s(c,{done:!!W,[k.flag]:!!W});return}let He=$!==null&&$!==N;if(W!==N){await s(c,{done:!!W,[k.flag]:!!W});return}if(He){let _e=Vt(b.line,!!$);await r(c,f,b.absStart,b.absEnd,_e),await s(c,{[k.flag]:!!$});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function Jt(t,e){let a=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},o=!(typeof a.done=="boolean"&&a.done);await t.fileManager.processFrontMatter(e,l=>{l.done=o});let s=await t.vault.read(e),r=["My Task","My Project","My Goal"];for(let l of r){let i=Xt(s,l);if(!i)continue;let c=Qt(s,i);if(!c)continue;let u=Vt(c.line,o),d=s.slice(0,c.absStart)+u+s.slice(c.absEnd);d!==s&&await t.vault.modify(e,d);break}}var ee=require("obsidian");function xn(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Fn(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function $n(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function vn(t){return/<%[\s\S]*?%>/.test(t)}function An(t,e=1500){let n=t?.stat?.ctime??0;return Date.now()-n<e}function Mn(t,e,n,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function Pn(t,e){let n=e.map(xn).join("|"),o=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(t);if(!o)return null;let s=o.index+o[0].length,r=(o[0].match(/^#+/)||["#"])[0].length,l=new RegExp(`^#{1,${r}}\\s+`,"gim");l.lastIndex=s;let i=l.exec(t);return{start:s,end:i?i.index:t.length}}var te=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function Sn(t,e){let n=t.slice(e.start,e.end);te.lastIndex=0;let a=te.exec(n);if(!a)return null;let o=e.start+a.index,s=o+a[0].length,r=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:s,line:a[0],checked:r}}function Dn(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}function ne(t,e){let n=new Set,a=i=>{let c=t.workspace.getActiveViewOfType(ee.MarkdownView),d=!!c&&c.file?.path===i.path&&c?.getMode()!=="preview";return{editor:c?.editor,inEdit:d}},o=async(i,c)=>{n.add(i.path);try{await t.fileManager.processFrontMatter(i,u=>{for(let d of Object.keys(c))u[d]=c[d]})}finally{n.delete(i.path)}},s=async(i,c,u,d,m)=>{let{editor:g,inEdit:f}=a(i);n.add(i.path);try{if(f&&g){let h=g.offsetToPos(u),p=g.offsetToPos(d);await new Promise(requestAnimationFrame),g.replaceRange(m,h,p)}else{let h=c.slice(0,u)+m+c.slice(d);h!==c&&await t.vault.modify(i,h)}}finally{n.delete(i.path)}},l=Fn(async()=>{let i=t.workspace.getActiveFile();if(!i||e?.(i)||$n(i.path)||An(i)||n.has(i.path))return;let u=(t.metadataCache.getFileCache(i)??{}).frontmatter??{},{editor:d,inEdit:m}=a(i),g=m&&d?d.getValue():await t.vault.read(i);if(!g||vn(g)||!Mn(i.path,i.basename,g,u))return;let f=Pn(g,["\u270D\uFE0F Log","Log"]);if(!f)return;let h=Sn(g,f),p=typeof u.done=="boolean"?u.done:null,k=typeof u._habit_sync_state=="boolean"?u._habit_sync_state:null;if(!h&&p===null)return;if(k===null){h?await o(i,{done:!!h.checked,_habit_sync_state:!!h.checked}):p!==null&&await o(i,{_habit_sync_state:!!p});return}let T=h?h.checked:null,b=p!==null&&p!==k;if(T!==null&&T!==k){await o(i,{done:!!T,_habit_sync_state:!!T});return}if(b&&h){let N=Dn(h.line,!!p);await s(i,g,h.absStart,h.absEnd,N),await o(i,{_habit_sync_state:!!p});return}},150);t.workspace.on("file-open",()=>l()),t.workspace.on("active-leaf-change",()=>l()),t.workspace.on("layout-change",()=>l()),t.workspace.on("editor-change",()=>l()),t.metadataCache.on("changed",()=>l()),t.metadataCache.on("resolved",()=>l()),t.vault.on("modify",()=>l()),t.vault.on("rename",()=>l()),t.vault.on("create",()=>l())}var E=require("obsidian");var se={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - "},Cn="03 SaveBox/Templates";function $t(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function re(t){return t.trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function ht(t){return String(t).padStart(2,"0")}function En(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),week:a}}async function ie(t,e){let n=(0,E.normalizePath)(e).split("/"),a="";for(let o of n){a=a?`${a}/${o}`:o;try{await t.vault.createFolder(a)}catch{}}}function U(t,e){let n=t.vault.getAbstractFileByPath((0,E.normalizePath)(e));return n instanceof E.TFile?n:null}function Ln(t,e){let n=new Date;switch(t){case"daily":return`02 Execution/1 Daily/${`${n.getFullYear()}-${ht(n.getMonth()+1)}-${ht(n.getDate())}.md`}`;case"weekly":{let{isoYear:a,week:o}=En(n);return`02 Execution/2 Weekly/${`${a}-W${ht(o)}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${n.getFullYear()}-${ht(n.getMonth()+1)}.md`}`;case"quarterly":{let a=Math.floor(n.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${n.getFullYear()}-Q${a}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${n.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/${$t(e)}.md`;default:return`03 SaveBox/Active/${se[t]}${$t(e)}.md`}}async function ae(t,e){let n=`${e.charAt(0).toUpperCase()}${e.slice(1)} Template.md`,a=(0,E.normalizePath)(`${Cn}/${n}`),o=t.vault.getAbstractFileByPath(a);return o instanceof E.TFile?t.vault.read(o):""}async function jn(t,e,n){let a=(0,E.normalizePath)(e),o=a.replace(/\/[^/]+$/,""),s=a.split("/").pop();await ie(t,o);let r=U(t,a);if(r)return r;let l=t.vault.getFiles().find(c=>c.name===s);if(l&&l.path!==a){await t.fileManager.renameFile(l,a);let c=U(t,a);if(c){if(!(await t.vault.read(c)).trim()){let d=await ae(t,n);d&&await t.vault.modify(c,d)}return c}}let i=await ae(t,n);return await t.vault.create(a,i??"")}async function oe(t,e,n){if(!["task","project","goal","area","wish","habit"].includes(n))return e;let a=se[n],o=e.path.startsWith("03 SaveBox/Active/"),s=e.basename.startsWith(a);if(!o||s)return e;let r=e.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),l=re(r||"Untitled"),i=(0,E.normalizePath)(`03 SaveBox/Active/${a}${$t(l)}.md`);if(i===e.path)return e;let c=U(t,i);return c||(await t.fileManager.renameFile(e,i),U(t,i)??e)}function On(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}async function Yn(t,e,n){for(let s=0;s<25&&!t.metadataCache.getFileCache(e)?.headings?.length;s++)await new Promise(l=>setTimeout(l,40));let a=e.basename,o=On(n);await Bt(t,e,o,a)}async function H(t,e,n){let a=["daily","weekly","monthly","quarterly","yearly"].includes(e),o=(0,E.normalizePath)(Ln(e,n));if(a){let d=await jn(t,o,e);return await t.workspace.getLeaf(!1).openFile(d),d}let s=["task","project","goal","area","wish","habit"].includes(e)?re(n):n,r=U(t,o);if(r){let d=await oe(t,r,e);return await t.workspace.getLeaf(!1).openFile(d),d}let l=await Gt(t,{kind:e,title:s}),i=o.replace(/\/[^/]+$/,"");await ie(t,i),l.path!==o&&await t.fileManager.renameFile(l,o);let c=U(t,o)??l;["task","project","goal"].includes(e)&&await Yn(t,c,e);let u=await oe(t,c,e);return await t.workspace.getLeaf(!1).openFile(u),u}var ce=(t,e)=>H(t,"task",e),le=(t,e)=>H(t,"project",e),ue=(t,e)=>H(t,"goal",e);var nt=t=>H(t,"daily",""),vt=t=>H(t,"weekly",""),At=t=>H(t,"monthly",""),Mt=t=>H(t,"quarterly",""),Pt=t=>H(t,"yearly","");var Hn=window.moment,St=new Set,_n={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Dt={};for(let[t,e]of Object.entries(_n))for(let n of e)Dt[n.toLowerCase()]=t;var Rn=Object.keys(Dt).sort((t,e)=>e.length-t.length).join("|"),Nn=new RegExp(`\\b(?:${Rn})\\b`,"gi");function Wn(t){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(t);if(!n)return null;let a=n[0],o=n.index+a.length;return t[o]==="\r"&&t[o+1]===`
`?o+2:t[o]===`
`?o+1:o}function Bn(t,e){let n=Wn(t);if(n===null)return t.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${e}
`;let a=t.slice(0,n),s=t.slice(n).replace(/^\r?\n{0,}/,""),r=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+r+e+`
`+s}function de(t,e){let n=t.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(t.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t.basename))return!0;if(e){let a=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function In(t){let e=t.match(Nn);return e?[...new Set(e.map(n=>Dt[n.toLowerCase()]).filter(Boolean))]:[]}function Gn(t){let e=In(t);if(e.length===0)return!0;let n=Hn().format("dddd");return e.includes(n)}function Kn(t){let e=t.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return e?e[1].trim():t.trim()}async function he(t,e,n){let a=window.moment().format("YYYY-MM-DD"),o=`^${a}`;if(n.includes(o))return!1;let r=`- [ ] \u{1F504}Habit - ${Kn(e.basename)} ${a} ${o}`,l=Bn(n,r);return await t.vault.modify(e,l),!0}async function at(t,e){let n=e.path;if(!St.has(n)){St.add(n);try{if(!de(e))return;if(!Gn(e.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:e.path});return}let a=await t.vault.read(e);if(!de(e,a))return;await he(t,e,a)}finally{setTimeout(()=>St.delete(n),120)}}}async function fe(t,e){let n=await t.vault.read(e);await he(t,e,n)}var qn=window.moment,Un="03 SaveBox/Active",zn=/(^| )Habit -|^ðŸ”Habit -/i,Xn={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Ct={};for(let[t,e]of Object.entries(Xn))for(let n of e)Ct[n.toLowerCase()]=t;var Qn=Object.keys(Ct).sort((t,e)=>e.length-t.length).join("|"),Vn=new RegExp(`\\b(?:${Qn})\\b`,"gi");function Zn(t){let e=t.match(Vn);return e?[...new Set(e.map(n=>Ct[n.toLowerCase()]).filter(Boolean))]:[]}function Jn(t){let e=qn().format("dddd"),n=Zn(t);return{ok:n.length>0&&n.includes(e),todayName:e}}async function me(t,e=Un){let n=t.vault.getMarkdownFiles().filter(a=>a.path.startsWith(e+"/")).filter(a=>zn.test(a.basename));for(let a of n){let{ok:o}=Jn(a.basename);if(o)try{await at(t,a)}catch{}}}var ft=require("obsidian"),L=window.moment,ta=t=>L(t).format("YYYY-MM-DD");function pe(t){let e=L(t+"-01","YYYY-MM-DD").startOf("month"),n=e.clone().endOf("month");return{start:e,end:n}}function ea(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function na(t,e){let a=new RegExp(`^#{1,6}\\s+${ea(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${s}}\\s+`,"gim");r.lastIndex=o;let l=r.exec(t);return{start:o,end:l?l.index:t.length}}function aa(t){t=String(t).trim();let e=t.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||t.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||t.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||t.match(/ðŸ“…\s*(\d{4}-\d{2}-\d{2})/);return e?e[1]:null}async function oa(t,e){let n=t.vault.getAbstractFileByPath(e.sourcePath);return n instanceof ft.TFile?t.vault.read(n):""}function sa(t){let e=na(t,"\u270D\uFE0F Log")||{start:0,end:t.length},n=t.slice(e.start,e.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,o=[],s;for(;s=a.exec(n);){let r=s[1].toLowerCase()==="x",l=s[2],i=aa(l);i&&o.push({date:i,done:r})}return o}function ra(t){let e=new Map;for(let n of t)e.set(n.date,e.get(n.date)||!1||n.done);return e}function ia(t){let e={};for(let[a,o]of t){let s=L(a).format("YYYY-MM");(e[s]||(e[s]=[])).push({date:a,done:o})}return Object.keys(e).sort().slice(-3).reverse().map(a=>{let o=e[a],s=o.length?Math.round(o.filter(r=>r.done).length/o.length*100):0;return{label:L(a,"YYYY-MM").format("MMM"),pct:s}})}function ca(t,e=90){let n=0,a=L();for(let o=0;o<e;o++){let s=ta(a);if(t.get(s))n++;else break;a.subtract(1,"day")}return n}function la(t,e,n){let a=t.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let o=a.createDiv({cls:"month-bars"});e.forEach(({label:s,pct:r},l)=>{let i=o.createDiv({cls:"month-row"});i.innerHTML=`
      <div class="month-label">${s}</div>
      <div class="bar-track">
        <div class="bar-fill ${l===0?"bar-orange":"bar-purple"}" style="width:${r}%;"></div>
      </div>
      <div class="pct-text">${r}<span class="pct-symbol">%</span></div>
    `})}function ge(t,e,n,a){let o=f=>L(f).format("YYYY-MM-DD"),s=n.clone().startOf("isoWeek"),r=a.clone().endOf("isoWeek"),l=[...e.keys()].sort(),i=null;for(let f=l.length-1;f>=0;f--){let h=l[f];if(!L(h).isAfter(a)){if(L(h).isBefore(n))break;if(e.get(h)){i=h;break}}}let c=t.createDiv({cls:"weekly-streak-wrap"}),u=c.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(f=>u.createDiv({cls:"head",text:f}));let d=c.createDiv({cls:"weekly-streak-grid"}),m=[],g=r.clone().endOf("isoWeek");for(;g.isSameOrAfter(s);){let f=g.clone().startOf("isoWeek");m.push({weekStart:f.clone(),weekEnd:g.clone()}),g.subtract(1,"week")}for(let f of m){let h=f.weekStart.clone();for(let p=0;p<7;p++){let k=o(h),T=h.isSameOrAfter(n)&&h.isSameOrBefore(a),b=T?!!e.get(k):!1,$=d.createDiv({cls:"weekly-streak-cell"});T||$.classList.add("pad"),b&&T&&($.classList.add("hit"),k===i&&$.classList.add("latest-hit")),$.createDiv({cls:"num",text:T?h.format("D"):""}),$.createDiv({cls:"mmm",text:T?h.format("MMM"):""}),$.setAttr("title",T?`${h.format("ddd, DD MMM YYYY")} ${b?"\u2705 Done":"\u274C Missed"}`:""),h.add(1,"day")}}}function ua(t,e,n){let a=t.createDiv({cls:"month-switch"});return e.forEach((o,s)=>{let r=a.createEl("button",{text:o.label,cls:"month-btn"});s===0&&r.classList.add("active"),r.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(l=>l.classList.remove("active")),r.classList.add("active"),n(o.key)})}),a}function da(t){let e=document.createElement("style");e.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,t.appendChild(e)}async function ye(t,e,n){e.replaceChildren();let a=await oa(t,n),o=sa(a),s=ra(o),r=ia(s),l=ca(s);da(e),la(e,r,l);let c=Array.from(new Set([...s.keys()].map(d=>L(d).format("YYYY-MM")))).sort().slice(-3).reverse().map(d=>({key:d,label:L(d,"YYYY-MM").format("MMM")})),u=c[0]?.key;if(ua(e,c,d=>{u=d,e.querySelectorAll(".weekly-streak-wrap").forEach(f=>f.remove());let{start:m,end:g}=pe(d);ge(e,s,m,g)}),u){let{start:d,end:m}=pe(u);ge(e,s,d,m)}}function ha(t,e,n){let a=(()=>{let s=null;return()=>{s&&window.clearTimeout(s),s=window.setTimeout(async()=>{s=null,await ye(t.app,e,n)},120)}})();class o extends ft.MarkdownRenderChild{onload(){this.registerEvent(t.app.vault.on("modify",r=>{r?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("changed",r=>{r?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("resolved",()=>a())),this.registerEvent(t.app.workspace.on("editor-change",()=>a()))}}n.addChild(new o(e))}function we(t){let e=async(n,a,o)=>{await ye(t.app,a,o),ha(t,a,o)};t.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",e),t.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",e)}var mt=require("obsidian");var Et=class extends mt.SuggestModal{constructor(n){super(n.app);this.plugin=n;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(n){let a=[{label:"Open Today (Daily)",action:async()=>{await nt(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await vt(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await At(this.app)}},{label:"Open This Quarter",action:async()=>{await Mt(this.app)}},{label:"Open This Year",action:async()=>{await Pt(this.app)}}],o=n.trim().toLowerCase();return o?a.filter(s=>s.label.toLowerCase().includes(o)):a}renderSuggestion(n,a){a.createDiv({text:n.label})}async onChooseSuggestion(n){await n.action()}};function be(t){t.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",n=>{let a=new mt.Menu;a.addItem(o=>o.setTitle("Open Today (Daily)").onClick(async()=>{await nt(t.app)})),a.addItem(o=>o.setTitle("Open This Week (Weekly)").onClick(async()=>{await vt(t.app)})),a.addItem(o=>o.setTitle("Open This Month (Monthly)").onClick(async()=>{await At(t.app)})),a.addItem(o=>o.setTitle("Open This Quarter").onClick(async()=>{await Mt(t.app)})),a.addItem(o=>o.setTitle("Open This Year").onClick(async()=>{await Pt(t.app)})),a.showAtMouseEvent(n)}).setAttr("aria-label","WishMap: Periodic Notes"),t.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new Et(t).open()})}var Ot=require("obsidian");var z=require("obsidian");async function ke(t,e,n){let a=t.vault.getAbstractFileByPath(e);if(!(a instanceof z.TFile))return;let o=await t.vault.read(a),s=o.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/),r=o,l={};if(s){try{l=(0,z.parseYaml)(s[1])??{}}catch{l={}}r=o.slice(s[0].length)}for(let[u,d]of Object.entries(n))d!==void 0&&(l[u]=d);let c=`---
${(0,z.stringifyYaml)(l).trimEnd()}
---
${r}`;c!==o&&await t.vault.modify(a,c)}function Yt(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}function _(t,e){let n=Yt(e.basename);return/^project(\s|:|-|_)/.test(n)}function I(t,e){let n=Yt(e.basename);return/^task(\s|:|-|_)/.test(n)}function B(t,e){let n=Yt(e.basename);return/^goal(\s|:|-|_)/.test(n)}function Te(t,e){let a=t.metadataCache.getFileCache(e)?.links??[],o=new Set,s=[];for(let r of a){let l=t.metadataCache.getFirstLinkpathDest(r.link,e.path);l instanceof Ot.TFile&&l.extension==="md"&&(o.has(l.path)||(o.add(l.path),s.push(l)))}return s}function xe(t,e){return Te(t,e).filter(n=>I(t,n))}function fa(t,e){return Te(t,e).filter(n=>_(t,n))}function jt(t,e){let n=t.metadataCache.getFileCache(e)?.frontmatter??{},a=["duration_hours","durationHours","duration","duration hours"];for(let o of a)if(n[o]!==void 0){let s=(typeof n[o]=="string",Number(n[o]));if(Number.isFinite(s))return s}return 0}async function Fe(t,e,n,a){let o=t.metadataCache.getFileCache(e)?.frontmatter?.[n],s=Number(o),r=Math.round(a*10)/10;Number.isFinite(s)&&Math.abs(s-r)<.05||await ke(t,e.path,{[n]:r})}async function ot(t,e){if(!_(t,e))return;let n=xe(t,e),a=0;for(let o of n)a+=jt(t,o);await Fe(t,e,"duration_hours",a)}async function Ht(t,e){if(!B(t,e))return;let n=fa(t,e),a=xe(t,e),o=0;for(let s of n)o+=jt(t,s);for(let s of a)o+=jt(t,s);await Fe(t,e,"duration_hours",o)}function Lt(t,e,n){let a=[],o=t.metadataCache.resolvedLinks,s=new Set;for(let[r,l]of Object.entries(o)){if(!l[e.path])continue;let i=t.vault.getAbstractFileByPath(r);i instanceof Ot.TFile&&i.extension==="md"&&n(t,i)&&(s.has(i.path)||(s.add(i.path),a.push(i)))}return a}function O(t,e){if(_(t,e))return[e,...Lt(t,e,B)];if(I(t,e)){let n=Lt(t,e,_),a=Lt(t,e,B);return[...n,...a]}return B(t,e)?[e]:[]}var $e=require("obsidian");function _t(t){let{app:e}=t;console.log("[WishMap] rollup auto: wiring listeners");let n=new Map;function a(s){let r=s.path,l=n.get(r);l&&window.clearTimeout(l);let i=window.setTimeout(async()=>{if(n.delete(r),_(e,s)){await ot(e,s);for(let c of O(e,s).filter(u=>B(e,u)))await Ht(e,c)}else B(e,s)&&await Ht(e,s)},300);n.set(r,i)}function o(s){if(s instanceof $e.TFile&&s.extension==="md"){console.log("[WishMap] rollup auto: file change",s.path);for(let r of O(e,s))a(r)}}t.registerEvent(e.metadataCache.on("changed",o)),t.registerEvent(e.vault.on("modify",o)),t.registerEvent(e.vault.on("create",o)),t.registerEvent(e.vault.on("rename",o)),t.registerEvent(e.vault.on("delete",o)),t.addCommand({id:"wishmap-rollup-current",name:"Recompute duration for current note",checkCallback:s=>{let r=e.workspace.getActiveFile();return!r||r.extension!=="md"?!1:(s||a(r),!0)}}),e.workspace.onLayoutReady(()=>{let s=e.vault.getMarkdownFiles();for(let r of s)for(let l of O(e,r))a(l)})}var Y=require("obsidian"),pt="03 SaveBox/Active",ma=["duration_hours","durationHours","duration","duration hours"],pa=2;function Z(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}var yt=t=>/^area(\s|:|-|_)/.test(Z(t.basename)),st=t=>/^wish(\s|:|-|_)/.test(Z(t.basename)),rt=t=>/^goal(\s|:|-|_)/.test(Z(t.basename)),q=t=>/^project(\s|:|-|_)/.test(Z(t.basename)),it=t=>/^task(\s|:|-|_)/.test(Z(t.basename)),ct=t=>/^habit(\s|:|-|_)/.test(Z(t.basename));var ga=t=>t.path===pt||t.path.startsWith(pt+"/"),A=t=>t.vault.getMarkdownFiles().filter(ga),y=(t,e)=>t.basename.localeCompare(e.basename),G=(t,e)=>t.metadataCache.getFileCache(e),Nt=(t,e)=>G(t,e)?.frontmatter??{};function ya(t){let e=Number(String(t??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(e)?e:NaN}function R(t,e){for(let n of ma)if(Nt(t,e)[n]!==void 0){let a=ya(Nt(t,e)[n]);if(Number.isFinite(a))return a}return NaN}function wa(t,e){let n=new Set;for(let o of G(t,e)?.tags??[])n.add(String(o?.tag??o).replace(/^#/,""));let a=Nt(t,e).tags;return Array.isArray(a)?a.forEach(o=>o&&n.add(String(o).replace(/^#/,""))):a&&n.add(String(a).replace(/^#/,"")),Array.from(n)}var w=(t,e)=>{let n=wa(t,e);return n.length?" "+n.map(a=>`#${a}`).join(" "):""},gt=t=>Number(t.toFixed(pa)),M=t=>`${gt(t)} ${gt(t)===1?"hr":"hrs"}`,P=t=>`<span class="duration-chip">${t}</span>`,x=(t,e)=>e?`<span class="grey-link">~~${t}~~ \u2705</span>`:t;function J(t,e){let n=e.split(`
`).map(a=>a?`> ${a}`:">").join(`
`);return`> [!wishmap]+ ${t}
>
${n}
`}function ve(){return`
.duration-chip{display:inline-block;padding:0 6px;border-radius:12px;line-height:1.6;font-size:0.9em;background-color:var(--interactive-accent-hover);color:var(--background-primary);}
.grey-link a{color:var(--text-faint)!important;}
.callout[data-callout="wishmap"] .callout-icon{display:none;} /* hide icon */
`}function Ae(t,e){let n=G(t,e)?.links??[],a=new Set,o=[];for(let s of n){let r=t.metadataCache.getFirstLinkpathDest(s.link,e.path);r instanceof Y.TFile&&r.extension==="md"&&!a.has(r.path)&&(a.add(r.path),o.push(r))}return o}var S=(t,e,n)=>Ae(t,e).some(a=>a.path===n.path)||Ae(t,n).some(a=>a.path===e.path),ba=(t,e)=>A(t).filter(st).filter(n=>S(t,e,n)),Pe=(t,e)=>A(t).filter(rt).filter(n=>S(t,e,n)),X=(t,e)=>A(t).filter(q).filter(n=>S(t,e,n)),K=(t,e)=>A(t).filter(it).filter(n=>S(t,e,n)),wt=(t,e)=>A(t).filter(ct).filter(n=>S(t,e,n)),ka=(t,e)=>A(t).filter(q).filter(n=>S(t,e,n)),Ta=(t,e)=>A(t).filter(it).filter(n=>S(t,e,n)),xa=(t,e)=>A(t).filter(ct).filter(n=>S(t,e,n)),Fa=(t,e)=>A(t).filter(q).filter(n=>S(t,e,n)),$a=(t,e)=>A(t).filter(it).filter(n=>S(t,e,n)),va=(t,e)=>A(t).filter(ct).filter(n=>S(t,e,n)),Aa=(t,e)=>A(t).filter(it).filter(n=>S(t,e,n)),Ma=(t,e)=>A(t).filter(ct).filter(n=>S(t,e,n));function Q(t,e){let n=K(t,e).map(s=>({d:R(t,s),done:v(t,s)})).filter(s=>Number.isFinite(s.d)&&s.d>0),a=n.reduce((s,r)=>s+r.d,0),o=n.filter(s=>s.done).reduce((s,r)=>s+r.d,0);return a<=0?{total:null,pct:null}:{total:gt(a),pct:Math.round(o/a*100)}}var V=(t,e)=>K(t,e).length>0&&K(t,e).every(n=>v(t,n));function Se(t,e){let n=X(t,e),a=0,o=0,s=!1;for(let r of n){let{total:l,pct:i}=Q(t,r);Number.isFinite(l)&&l>0&&(s=!0,a+=l,i!=null&&(o+=l*(i/100)))}return!s||a<=0?{total:null,pct:null}:{total:gt(a),pct:Math.round(o/a*100)}}var De=(t,e)=>X(t,e).length>0&&X(t,e).every(n=>V(t,n));function v(t,e){let a=(G(t,e)?.listItems??[]).find(o=>o&&"task"in o);return String(a?.task??"").toLowerCase()==="x"}function Wt(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${w(t,e)}`);for(let o of ba(t,e).sort(y))if(!n.has(o.path)){n.add(o.path),a.push(`  - [[${o.path}|${o.basename}]]${w(t,o)}`);for(let s of Pe(t,o).sort(y)){if(n.has(s.path))continue;n.add(s.path);let{total:r,pct:l}=Se(t,s),i=De(t,s),c=Number.isFinite(r)&&r>0?` ${P(M(r))}`:"",u=l!=null&&l>0&&l<100?` ${l}%`:"",d=`[[${s.path}|${s.basename}]]${c}${u}${w(t,s)}`;a.push(`    - ${x(d,i)}`);for(let m of X(t,s).sort(y)){if(n.has(m.path))continue;n.add(m.path);let{total:g,pct:f}=Q(t,m),h=V(t,m),p=Number.isFinite(g)&&g>0?` ${P(M(g))}`:"",k=f!=null&&f>0&&f<100?` ${f}%`:"",T=`[[${m.path}|${m.basename}]]${p}${k}${w(t,m)}`;a.push(`      - ${x(T,h)}`);for(let b of K(t,m).sort(y)){if(n.has(b.path))continue;n.add(b.path);let $=R(t,b),N=Number.isFinite($)&&$>0?` ${P(M($))}`:"",W=`[[${b.path}|${b.basename}]]${N}${w(t,b)}`;a.push(`        - ${x(W,v(t,b))}`)}for(let b of wt(t,m).sort(y)){if(n.has(b.path))continue;n.add(b.path);let $=`[[${b.path}|${b.basename}]]${w(t,b)}`;a.push(`        - ${x($,v(t,b))}`)}}}}for(let o of ka(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let{total:s,pct:r}=Q(t,o),l=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${l}${i}${w(t,o)}`,V(t,o))}`)}for(let o of Ta(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let s=R(t,o),r=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${r}${w(t,o)}`,v(t,o))}`)}for(let o of xa(t,e).sort(y))n.has(o.path)||(n.add(o.path),a.push(`  - ${x(`[[${o.path}|${o.basename}]]${w(t,o)}`,v(t,o))}`));return J(`${e.basename}`,a.join(`
`))}function Ce(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${w(t,e)}`);for(let o of Pe(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let{total:s,pct:r}=Se(t,o),l=De(t,o),i=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"",c=r!=null&&r>0&&r<100?` ${r}%`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${i}${c}${w(t,o)}`,l)}`);for(let u of X(t,o).sort(y)){if(n.has(u.path))continue;n.add(u.path);let{total:d,pct:m}=Q(t,u),g=V(t,u),f=Number.isFinite(d)&&d>0?` ${P(M(d))}`:"",h=m!=null&&m>0&&m<100?` ${m}%`:"";a.push(`    - ${x(`[[${u.path}|${u.basename}]]${f}${h}${w(t,u)}`,g)}`);for(let p of K(t,u).sort(y)){if(n.has(p.path))continue;n.add(p.path);let k=R(t,p),T=Number.isFinite(k)&&k>0?` ${P(M(k))}`:"";a.push(`      - ${x(`[[${p.path}|${p.basename}]]${T}${w(t,p)}`,v(t,p))}`)}for(let p of wt(t,u).sort(y))n.has(p.path)||(n.add(p.path),a.push(`      - ${x(`[[${p.path}|${p.basename}]]${w(t,p)}`,v(t,p))}`))}}for(let o of Fa(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let{total:s,pct:r}=Q(t,o),l=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${l}${i}${w(t,o)}`,V(t,o))}`)}for(let o of $a(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let s=R(t,o),r=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${r}${w(t,o)}`,v(t,o))}`)}for(let o of va(t,e).sort(y))n.has(o.path)||(n.add(o.path),a.push(`  - ${x(`[[${o.path}|${o.basename}]]${w(t,o)}`,v(t,o))}`));return J(`${e.basename}`,a.join(`
`))}function Ee(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${w(t,e)}`);for(let o of X(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let{total:s,pct:r}=Q(t,o),l=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${l}${i}${w(t,o)}`,V(t,o))}`);for(let c of K(t,o).sort(y)){if(n.has(c.path))continue;n.add(c.path);let u=R(t,c),d=Number.isFinite(u)&&u>0?` ${P(M(u))}`:"";a.push(`    - ${x(`[[${c.path}|${c.basename}]]${d}${w(t,c)}`,v(t,c))}`)}for(let c of wt(t,o).sort(y))n.has(c.path)||(n.add(c.path),a.push(`    - ${x(`[[${c.path}|${c.basename}]]${w(t,c)}`,v(t,c))}`))}for(let o of Aa(t,e).sort(y)){if(n.has(o.path))continue;n.add(o.path);let s=R(t,o),r=Number.isFinite(s)&&s>0?` ${P(M(s))}`:"";a.push(`  - ${x(`[[${o.path}|${o.basename}]]${r}${w(t,o)}`,v(t,o))}`)}for(let o of Ma(t,e).sort(y))n.has(o.path)||(n.add(o.path),a.push(`  - ${x(`[[${o.path}|${o.basename}]]${w(t,o)}`,v(t,o))}`));return J(`${e.basename}`,a.join(`
`))}function Le(t,e){let n=[];n.push(`- [[${e.path}|${e.basename}]]${w(t,e)}`);for(let a of K(t,e).sort(y)){let o=R(t,a),s=Number.isFinite(o)&&o>0?` ${P(M(o))}`:"";n.push(`  - ${x(`[[${a.path}|${a.basename}]]${s}${w(t,a)}`,v(t,a))}`)}for(let a of wt(t,e).sort(y))n.push(`  - ${x(`[[${a.path}|${a.basename}]]${w(t,a)}`,v(t,a))}`);return J(`${e.basename}`,n.join(`
`))}function Me(t){return yt(t)?0:st(t)?1:rt(t)?2:q(t)?3:99}function Pa(t,e,n){let a=G(t,e)?.links??[],o=G(t,n)?.links??[],s=a.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,e.path)?.path===n.path),r=o.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,n.path)?.path===e.path);return s||r}function Sa(t,e){let n=h=>(G(t,h)?.links??[]).length>0,a=h=>{for(let[,p]of Object.entries(t.metadataCache.resolvedLinks))if(p[h.path])return!0;return!1},o=h=>!n(h)&&!a(h),s=h=>{let p=Me(h);return p===0?!1:A(t).filter(T=>Me(T)<p).some(T=>Pa(t,T,h))},r=h=>!s(h),l=e.filter(st).sort(y),i=e.filter(rt).sort(y),c=e.filter(q).sort(y),u=e.filter(it).sort(y),d=e.filter(ct).sort(y),m=h=>h.map(p=>`- [[${p.path}|${p.basename}]]`).join(`
`),g=(h,p)=>p.length?J(`${h} (${p.length})`,m(p)):"",f=[];for(let h of l.filter(r))f.push(Rt(t,h));for(let h of i.filter(r))f.push(Rt(t,h));for(let h of c.filter(r))f.push(Rt(t,h));return f.push(g("\u{1F4CC} Solo Tasks",u.filter(h=>o(h)||r(h)))),f.push(g("\u{1F501} Solo Habits",d.filter(h=>o(h)||r(h)))),f.push(g("\u{1F4AD} Standalone Wishes",l.filter(o))),f.push(g("\u{1F3AF} Standalone Goals",i.filter(o))),f.push(g("\u{1F680} Standalone Projects",c.filter(o))),f.filter(Boolean).join(`

`)}function Rt(t,e){if(yt(e))return Wt(t,e);if(st(e))return Ce(t,e);if(rt(e))return Ee(t,e);if(q(e))return Le(t,e);let n=w(t,e);return J(`\u{1F4C4} ${e.basename}`,`- [[${e.path}|${e.basename}]]${n}`)}function je(t){let e=t.app;t.registerMarkdownCodeBlockProcessor("wishmap",async(n,a,o)=>{a.empty(),a.createEl("style",{text:ve()});let s=await Oe(e);await Y.MarkdownRenderer.render(e,s,a,o.sourcePath,t)}),t.registerMarkdownCodeBlockProcessor("wishmap-local",async(n,a,o)=>{let s=String(n||"").trim().toLowerCase(),r=e.vault.getAbstractFileByPath(o.sourcePath);if(!(r instanceof Y.TFile)||r.extension!=="md"){a.setText("No file context");return}a.empty(),a.createEl("style",{text:ve()});let l="";s==="project"||!s&&q(r)?l=Le(e,r):s==="goal"||!s&&rt(r)?l=Ee(e,r):s==="wish"||!s&&st(r)?l=Ce(e,r):s==="area"||!s&&yt(r)?l=Wt(e,r):l="_Place in an Area, Wish, Goal, or Project note, or pass one of: area | wish | goal | project._",await Y.MarkdownRenderer.render(e,l,a,o.sourcePath,t)})}async function Oe(t){let e=A(t),n=e.filter(yt).sort(y),a=[];for(let o of n)a.push(Wt(t,o));return a.push(Sa(t,e)),a.filter(Boolean).join(`

`)}async function Ye(t){let e=await Oe(t),n=(0,Y.normalizePath)(`${pt}/_Maps/Area-Maps.md`),a=t.vault.getAbstractFileByPath(n);if(a instanceof Y.TFile)await t.vault.read(a)!==e&&await t.vault.modify(a,e);else{try{await t.vault.createFolder(`${pt}/_Maps`)}catch{}await t.vault.create(n,e)}return n}var bt=class extends F.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1}async onload(){console.log("WishMap v0.2 loaded"),_t(this),console.log("[WishMap] rollup auto: setup called from main"),je(this),this.addCommand({id:"wishmap-generate-area-maps",name:"Generate Area Maps note",callback:async()=>{let i=await Ye(this.app),c=this.app.vault.getAbstractFileByPath(i);c&&this.app.workspace.getLeaf(!0).openFile(c)}}),this.addCommand({id:"wishmap-print-note",name:"Print (Export to PDF)",callback:()=>{this.app.commands.executeCommandById?.("markdown:export-pdf")}}),await this.loadSettings();let n=new Map,a=i=>{let c=i.path,u=n.get(c);u&&window.clearTimeout(u);let d=window.setTimeout(async()=>{n.delete(c),await ot(this.app,i)},300);n.set(c,d)};this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof F.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!I(this.app,c))return;let u=O(this.app,c);for(let d of u)a(d)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof F.TFile)||c.extension!=="md"||!I(this.app,c))return;let u=O(this.app,c);for(let d of u)a(d)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await Kt(this.app),new F.Notice("Starter structure created.")}}),qt(this.app),this.registerEvent(this.app.vault.on("create",async i=>{let c=i instanceof F.TFile?i:null;if(!c||c.extension!=="md")return;let d=this.app.metadataCache.getFileCache(c)?.frontmatter;(d&&(d.type==="habit"||d.category==="habit")||/\bhabit\b/i.test(c.basename))&&await fe(this.app,c)})),this.registerEvent(this.app.workspace.on("file-open",async i=>{i&&await at(this.app,i)})),Zt(this.app),ne(this.app),be(this),we(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await me(this.app),new F.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new F.Notice("No active file.");await Jt(this.app,i)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new F.Notice("No active file.");await at(this.app,i)}});let o=!1;this.app.workspace.onLayoutReady(()=>{o||(this.ensureTodayDailyOpenOnce(),o=!0)}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{o||(this.ensureTodayDailyOpenOnce(),o=!0)})),console.log("WishMap ready");let s=new Map,r=(i,c=300)=>{let u=i.path,d=s.get(u);d&&window.clearTimeout(d);let m=window.setTimeout(async()=>{s.delete(u),await ot(this.app,i)},c);s.set(u,m)},l=(i,c=1500)=>new Promise(u=>{let d=!1,m=()=>{d||(d=!0,u())},g=this.app.metadataCache.on("changed",f=>{f?.path===i&&(this.app.metadataCache.offref(g),m())});window.setTimeout(()=>{this.app.metadataCache.offref(g),m()},c)});this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof F.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!I(this.app,c))return;await l(c.path,1500);let u=O(this.app,c);for(let d of u)r(d,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof F.TFile)||c.extension!=="md"||!I(this.app,c))return;let u=O(this.app,c);for(let d of u)r(d,200)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;!(c instanceof F.TFile)||c.extension!=="md"||_(this.app,c)&&r(c,200)})),_t(this)}onunload(){console.log("WishMap unloaded")}async openRouted(n){switch(n.type){case"task":await ce(this.app,n.name??"");break;case"project":await le(this.app,n.name??"");break;case"goal":await ue(this.app,n.name??"");break;case"daily":await nt(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let n=window.moment(),a=n.format("YYYY-MM-DD"),o=n.format("dddd");return`02 Execution/1 Daily/${a} ${o}.md`}async createOrOpenTodayDaily(){let n=(0,F.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(n);if(a instanceof F.TFile){await this.app.workspace.getLeaf(!0).openFile(a);return}let s=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),r="";s instanceof F.TFile&&(r=await this.app.vault.read(s),r=r.replace(/{{date}}/g,this.todayISO()));let l=await this.app.vault.create(n,r);await this.app.workspace.getLeaf(!0).openFile(l),console.log("Created today\u2019s daily:",n)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let n=this.todayISO(),a=(0,F.normalizePath)(this.pathForTodayDaily()),o=this.app.vault.getAbstractFileByPath(a);if(o instanceof F.TFile){await this.app.workspace.getLeaf(!0).openFile(o),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings()}async loadSettings(){let n=await this.loadData();this.data=n??{}}async saveSettings(){await this.saveData(this.data)}};
