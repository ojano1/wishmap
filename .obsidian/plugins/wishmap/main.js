/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var Ft=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Ue=Object.prototype.hasOwnProperty;var qe=(t,e)=>{for(var n in e)Ft(t,n,{get:e[n],enumerable:!0})},ze=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Ke(e))!Ue.call(t,a)&&a!==n&&Ft(t,a,{get:()=>e[a],enumerable:!(s=Ge(e,a))||s.enumerable});return t};var Xe=t=>ze(Ft({},"__esModule",{value:!0}),t);var _a={};qe(_a,{default:()=>xt});module.exports=Xe(_a);var v=require("obsidian");var St=require("obsidian");var at=require("obsidian");function Qe(t,e,n){let s=t.metadataCache.getFileCache(e);if(!s?.headings)return null;let a=u=>u.trim().toLowerCase(),o=a(n),r=s.headings.sort((u,d)=>u.position.start.line-d.position.start.line),l=r.findIndex(u=>a(u.heading)===o);if(l===-1)return null;let i=r[l].position.end.line+1,c=l<r.length-1?r[l+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:i,endLine:c}}async function Ut(t,e,n,s){let a=Qe(t,e,n);if(!a)return!1;let r=(await t.vault.read(e)).split(`
`),l=Math.min(a.startLine,r.length-1),i=Math.min(a.endLine,r.length-1),c=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let u=l;u<=i;u++){let d=r[u].match(c);if(!d)continue;let b=`- [${d[1]==="x"||d[1]==="X"?"x":" "}] ${s}`;return r[u]!==b&&(r[u]=b,await t.vault.modify(e,r.join(`
`))),!0}return!1}function j(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function Ve(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function Ze(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function Je(t=new Date){return t.getFullYear()}function tn(t=new Date){return Math.floor(t.getMonth()/3)+1}function en(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+n)/864e5+1)/7)}function vt(t,e,n=new Date){let s=j(n),a=t;return a=a.replace(/{{\s*title\s*}}/gi,e),a=a.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,o=>s),a=a.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),a=a.replace(/{{\s*weekday\s*}}/gi,Ve(n)),a=a.replace(/{{\s*monthShort\s*}}/gi,Ze(n)),a=a.replace(/{{\s*year\s*}}/gi,String(Je(n))),a=a.replace(/{{\s*isoWeek\s*}}/gi,String(en(n))),a=a.replace(/{{\s*quarter\s*}}/gi,String(tn(n))),a}function nn(t,e){let n=(0,at.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function ft(t,e){let n=(0,at.normalizePath)(e).split("/"),s="";for(let a of n)s=s?`${s}/${a}`:a,t.vault.getAbstractFileByPath(s)||await t.vault.createFolder(s)}async function E(t,e,n){let s=(0,at.normalizePath)(e);if(!nn(t,s)){let o=s.split("/").slice(0,-1).join("/");o&&await ft(t,o),await t.vault.create(s,n)}}var mt=require("obsidian");var L="03 SaveBox/Templates",At={area:`${L}/Area Template.md`,wish:`${L}/Wish Template.md`,goal:`${L}/Goal Template.md`,project:`${L}/Project Template.md`,task:`${L}/Task Template.md`,habit:`${L}/Habit Template.md`,note:`${L}/Note Template.md`,daily:`${L}/Daily Template.md`,weekly:`${L}/Weekly Template.md`,monthly:`${L}/Monthly Template.md`,quarterly:`${L}/Quarterly Template.md`,yearly:`${L}/Yearly Template.md`},Mt={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function st(t,e,n,s=new Date){let a=(0,mt.normalizePath)(At[e]),o=t.vault.getAbstractFileByPath(a);if(o instanceof mt.TFile){console.log(`[MMOS] Using VAULT template for ${e}: ${a}`);let r=await t.vault.read(o);return vt(r,n,s)}return console.log(`[MMOS] Using FALLBACK template for ${e}`),vt(Mt[e],n,s)}var an="03 SaveBox/Templates";async function sn(t,e){let n=t.vault.getMarkdownFiles().filter(o=>o.path.startsWith(an+"/")),s=o=>o.toLowerCase().trim().replace(/^[^a-z0-9]+/,""),a=n.find(o=>new RegExp(`^${e}(\\s|:|-|_)`,"i").test(s(o.basename)));return a?t.vault.read(a):""}async function zt(t,e){let{kind:n,title:s}=e,a=e.path??on(n,s),o=a.substring(0,a.lastIndexOf("/"));o&&await ft(t,o);let r;if(n==="note"){if(r=await sn(t,"note"),!r){let i=a.split("/").pop().replace(/\.md$/i,"");r=`---
created: ${j(new Date)}
status: Active
---
# ${i}
`}}else r=await st(t,n,s,new Date);let l=await t.vault.create(a,r);return await t.fileManager.processFrontMatter(l,i=>{i.created??(i.created=j(new Date)),n==="task"?(i.status??(i.status="Active"),i.impact??(i.impact="Med"),i.slot??(i.slot="Morning"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(i.status??(i.status="Active"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="area"&&(i.status??(i.status="Active"))}),l}async function Xt(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of e)await ft(t,n);await E(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await E(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await E(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await E(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await E(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,s]of Object.entries(At))await E(t,s,Mt[n]);await E(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${j(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await E(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${j(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await E(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${j(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await E(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${j(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await E(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new St.Notice("\u2705 MindMap OS: starter structure updated.")}function on(t,e){let n=rn(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${qt("note")}${n}.md`;default:return`03 SaveBox/Active/${qt(t)}${n}.md`}}function qt(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";case"note":return"\u270F\uFE0FNote - ";default:return""}}function rn(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var ot=require("obsidian");var cn=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],Qt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - ",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function ln(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function un(t,e){let s=new RegExp(`^#{1,6}\\s+${ln(e)}\\s*$`,"gim").exec(t);if(!s)return null;let a=s.index+s[0].length,o=(s[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${o}}\\s+`,"gim");r.lastIndex=a;let l=r.exec(t);return{start:a,end:l?l.index:t.length}}function dn(t,e){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,s=t.slice(e.start,e.end);n.lastIndex=0;let a=n.exec(s);if(!a)return null;let o=e.start+a.index,r=o+a[0].length,l=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:r,line:a[0],checked:l}}async function hn(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(a=>setTimeout(a,40))}}async function fn(t,e,n,s){await hn(t,e);let a=await t.vault.read(e),o=un(a,n);if(!o)return!1;let r=dn(a,o);if(!r)return!1;let i=`- [${/\[(x|X)\]/.test(r.line)?"x":" "}] ${s}`;if(r.line.trimEnd()===i)return!0;let c=a.slice(0,r.absStart)+i+a.slice(r.absEnd);return c!==a&&await t.vault.modify(e,c),!0}function mn(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}function pn(t){return t instanceof ot.TFile&&t.extension.toLowerCase()==="md"}function gn(t){let e=t.match(/^(\w+)\s*(?:[-–]\s*|\s+)(.+)$/i);if(!e)return null;let n=e[1].toLowerCase();if(!cn.includes(n))return null;let s=e[2].trim();return{kind:n,title:s}}function yn(t,e){let n=wn(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${Qt.note}${n}.md`;default:return`03 SaveBox/Active/${Qt[t]}${n}.md`}}function wn(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function bn(t,e,n){await t.fileManager.processFrontMatter(e,s=>{s.created??(s.created=j(new Date)),n==="task"?(s.status??(s.status="Active"),s.impact??(s.impact="Medium"),s.slot??(s.slot="Morning"),s.done??(s.done=!1),s.duration_hours??(s.duration_hours=void 0),s.tags??(s.tags=[])):n==="goal"||n==="project"||n==="habit"?(s.status??(s.status="Active"),s.done??(s.done=!1)):n==="area"&&(s.status??(s.status="Active"))})}function Vt(t){t.vault.on("create",async e=>{try{if(!pn(e)||(await t.vault.read(e)).trim().length>0)return;let s=e.basename,a=gn(s);if(!a)return;let{kind:o,title:r}=a,l;o==="note"?(l=await st(t,"note",r,new Date),l||(l=`---
created: ${j(new Date)}
status: Active
---
# \u270F\uFE0FNote - ${r}
`)):l=await st(t,o,r,new Date),await t.vault.modify(e,l),await bn(t,e,o);let i=(0,ot.normalizePath)(yn(o,r));if(i!==e.path&&await t.fileManager.renameFile(e,i),o==="task"||o==="project"||o==="goal"){let c=t.vault.getAbstractFileByPath(i),u=c instanceof ot.TFile?c:e,d=mn(o),f=u.basename;await fn(t,u,d,f)}console.log(`[MMOS] wikilink routed \u2192 ${o} | ${r}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var Jt=require("obsidian");function $n(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Tn(t,e){let n=null;return(...s)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...s)},e)}}function te(t,e){let s=new RegExp(`^#{1,6}\\s+${$n(e)}\\s*$`,"gim").exec(t);if(!s)return null;let a=s.index+s[0].length,o=(s[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${o}}\\s+`,"gim");r.lastIndex=a;let l=r.exec(t);return{start:a,end:l?l.index:t.length}}var Zt=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function ee(t,e){let n=t.slice(e.start,e.end);Zt.lastIndex=0;let s=Zt.exec(n);if(!s)return null;let a=e.start+s.index,o=a+s[0].length,r=/\[(x|X)\]/.test(s[0]);return{absStart:a,absEnd:o,line:s[0],checked:r}}function ne(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var kn=2e3;function xn(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function Fn(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function vn(t){return/<%[\s\S]*?%>/.test(t)}function An(t){let e=t?.stat?.ctime??0;return Date.now()-e<kn}function ae(t,e){let n=new Set,s=t.vault.on("modify",c=>{n.has(c.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),a=c=>{let u=t.workspace.getActiveViewOfType(Jt.MarkdownView),f=!!u&&u.file?.path===c.path&&u?.getMode()!=="preview";return{editor:u?.editor,inEdit:f}},o=async(c,u)=>{n.add(c.path);try{await t.fileManager.processFrontMatter(c,d=>{for(let f of Object.keys(u))d[f]=u[f]})}finally{n.delete(c.path)}},r=async(c,u,d,f,b)=>{let{editor:w,inEdit:$}=a(c);n.add(c.path);try{if($&&w){let m=w.offsetToPos(d),k=w.offsetToPos(f);await new Promise(requestAnimationFrame),w.replaceRange(b,m,k)}else{let m=u.slice(0,d)+b+u.slice(f);m!==u&&await t.vault.modify(c,m)}}finally{n.delete(c.path)}},i=Tn(async()=>{let c=t.workspace.getActiveFile();if(!c||e?.(c)||xn(c.path))return;let d=(t.metadataCache.getFileCache(c)??{}).frontmatter??{};if(Fn(d))return;let{editor:f,inEdit:b}=a(c),w=b&&f?f.getValue():await t.vault.read(c);if(!w||vn(w)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(w)||An(c)||n.has(c.path))return;let m=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let k of m){let T=te(w,k.heading);if(!T)continue;let h=ee(w,T);if(!h)continue;let y=typeof d.done=="boolean"?d.done:null,C=typeof d[k.flag]=="boolean"?d[k.flag]:null,D=h.checked;if(C===null){await o(c,{done:!!D,[k.flag]:!!D});return}let nt=y!==null&&y!==C;if(D!==C){await o(c,{done:!!D,[k.flag]:!!D});return}if(nt){let Ie=ne(h.line,!!y);await r(c,w,h.absStart,h.absEnd,Ie),await o(c,{[k.flag]:!!y});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function se(t,e){let s=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},a=!(typeof s.done=="boolean"&&s.done);await t.fileManager.processFrontMatter(e,l=>{l.done=a});let o=await t.vault.read(e),r=["My Task","My Project","My Goal"];for(let l of r){let i=te(o,l);if(!i)continue;let c=ee(o,i);if(!c)continue;let u=ne(c.line,a),d=o.slice(0,c.absStart)+u+o.slice(c.absEnd);d!==o&&await t.vault.modify(e,d);break}}var re=require("obsidian");function Mn(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Sn(t,e){let n=null;return(...s)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...s)},e)}}function Pn(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function Dn(t){return/<%[\s\S]*?%>/.test(t)}function Cn(t,e=1500){let n=t?.stat?.ctime??0;return Date.now()-n<e}function En(t,e,n,s){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e)||s&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function Ln(t,e){let n=e.map(Mn).join("|"),a=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,r=(a[0].match(/^#+/)||["#"])[0].length,l=new RegExp(`^#{1,${r}}\\s+`,"gim");l.lastIndex=o;let i=l.exec(t);return{start:o,end:i?i.index:t.length}}var oe=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function jn(t,e){let n=t.slice(e.start,e.end);oe.lastIndex=0;let s=oe.exec(n);if(!s)return null;let a=e.start+s.index,o=a+s[0].length,r=/\[(x|X)\]/.test(s[0]);return{absStart:a,absEnd:o,line:s[0],checked:r}}function On(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}function ie(t,e){let n=new Set,s=i=>{let c=t.workspace.getActiveViewOfType(re.MarkdownView),d=!!c&&c.file?.path===i.path&&c?.getMode()!=="preview";return{editor:c?.editor,inEdit:d}},a=async(i,c)=>{n.add(i.path);try{await t.fileManager.processFrontMatter(i,u=>{for(let d of Object.keys(c))u[d]=c[d]})}finally{n.delete(i.path)}},o=async(i,c,u,d,f)=>{let{editor:b,inEdit:w}=s(i);n.add(i.path);try{if(w&&b){let $=b.offsetToPos(u),m=b.offsetToPos(d);await new Promise(requestAnimationFrame),b.replaceRange(f,$,m)}else{let $=c.slice(0,u)+f+c.slice(d);$!==c&&await t.vault.modify(i,$)}}finally{n.delete(i.path)}},l=Sn(async()=>{let i=t.workspace.getActiveFile();if(!i||e?.(i)||Pn(i.path)||Cn(i)||n.has(i.path))return;let u=(t.metadataCache.getFileCache(i)??{}).frontmatter??{},{editor:d,inEdit:f}=s(i),b=f&&d?d.getValue():await t.vault.read(i);if(!b||Dn(b)||!En(i.path,i.basename,b,u))return;let w=Ln(b,["\u270D\uFE0F Log","Log"]);if(!w)return;let $=jn(b,w),m=typeof u.done=="boolean"?u.done:null,k=typeof u._habit_sync_state=="boolean"?u._habit_sync_state:null;if(!$&&m===null)return;if(k===null){$?await a(i,{done:!!$.checked,_habit_sync_state:!!$.checked}):m!==null&&await a(i,{_habit_sync_state:!!m});return}let T=$?$.checked:null,h=m!==null&&m!==k;if(T!==null&&T!==k){await a(i,{done:!!T,_habit_sync_state:!!T});return}if(h&&$){let C=On($.line,!!m);await o(i,b,$.absStart,$.absEnd,C),await a(i,{_habit_sync_state:!!m});return}},150);t.workspace.on("file-open",()=>l()),t.workspace.on("active-leaf-change",()=>l()),t.workspace.on("layout-change",()=>l()),t.workspace.on("editor-change",()=>l()),t.metadataCache.on("changed",()=>l()),t.metadataCache.on("resolved",()=>l()),t.vault.on("modify",()=>l()),t.vault.on("rename",()=>l()),t.vault.on("create",()=>l())}var O=require("obsidian");var ue={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - "},Yn="03 SaveBox/Templates";function pt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function de(t){return t.trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function Nn(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),week:s}}async function he(t,e){let n=(0,O.normalizePath)(e).split("/"),s="";for(let a of n){s=s?`${s}/${a}`:a;try{await t.vault.createFolder(s)}catch{}}}function Q(t,e){let n=t.vault.getAbstractFileByPath((0,O.normalizePath)(e));return n instanceof O.TFile?n:null}function _n(t,e){let n=new Date;switch(t){case"daily":return`02 Execution/1 Daily/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}.md`}`;case"weekly":{let{isoYear:s,week:a}=Nn(n);return`02 Execution/2 Weekly/${`${s}-W${String(a).padStart(2,"0")}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}.md`}`;case"quarterly":{let s=Math.floor(n.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${n.getFullYear()}-Q${s}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${n.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/\u270F\uFE0FNote - ${pt(e)}.md`;case"area":case"wish":case"goal":case"project":case"task":case"habit":return`03 SaveBox/Active/${ue[t]}${pt(e)}.md`}return`03 SaveBox/Active/${pt(e)}.md`}async function ce(t,e){let n=`${e.charAt(0).toUpperCase()}${e.slice(1)} Template.md`,s=(0,O.normalizePath)(`${Yn}/${n}`),a=t.vault.getAbstractFileByPath(s);return a instanceof O.TFile?t.vault.read(a):""}async function Hn(t,e,n){let s=(0,O.normalizePath)(e),a=s.replace(/\/[^/]+$/,""),o=s.split("/").pop();await he(t,a);let r=Q(t,s);if(r)return r;let l=t.vault.getFiles().find(c=>c.name===o);if(l&&l.path!==s){await t.fileManager.renameFile(l,s);let c=Q(t,s);if(c){if(!(await t.vault.read(c)).trim()){let d=await ce(t,n);d&&await t.vault.modify(c,d)}return c}}let i=await ce(t,n);return await t.vault.create(s,i??"")}async function le(t,e,n){if(!["task","project","goal","area","wish","habit","note"].includes(n))return e;let s=ue[n],a=e.path.startsWith("03 SaveBox/Active/"),o=e.basename.startsWith(s);if(!a||o)return e;let r=e.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),l=de(r||"Untitled"),i=(0,O.normalizePath)(`03 SaveBox/Active/${s}${pt(l)}.md`);if(i===e.path)return e;let c=Q(t,i);return c||(await t.fileManager.renameFile(e,i),Q(t,i)??e)}function Rn(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}async function Bn(t,e,n){for(let o=0;o<25&&!t.metadataCache.getFileCache(e)?.headings?.length;o++)await new Promise(l=>setTimeout(l,40));let s=e.basename,a=Rn(n);await Ut(t,e,a,s)}async function B(t,e,n){let s=["daily","weekly","monthly","quarterly","yearly"].includes(e),a=(0,O.normalizePath)(_n(e,n));if(s){let d=await Hn(t,a,e);return await t.workspace.getLeaf(!1).openFile(d),d}let o=["task","project","goal","area","wish","habit","note"].includes(e)?de(n):n,r=Q(t,a);if(r){let d=await le(t,r,e);return await t.workspace.getLeaf(!1).openFile(d),d}let l=await zt(t,{kind:e,title:o}),i=a.replace(/\/[^/]+$/,"");await he(t,i),l.path!==a&&await t.fileManager.renameFile(l,a);let c=Q(t,a)??l;["task","project","goal"].includes(e)&&await Bn(t,c,e);let u=await le(t,c,e);return await t.workspace.getLeaf(!1).openFile(u),u}var fe=(t,e)=>B(t,"task",e),me=(t,e)=>B(t,"project",e),pe=(t,e)=>B(t,"goal",e);var rt=t=>B(t,"daily",""),Pt=t=>B(t,"weekly",""),Dt=t=>B(t,"monthly",""),Ct=t=>B(t,"quarterly",""),Et=t=>B(t,"yearly","");var Wn=window.moment,Lt=new Set,In={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},jt={};for(let[t,e]of Object.entries(In))for(let n of e)jt[n.toLowerCase()]=t;var Gn=Object.keys(jt).sort((t,e)=>e.length-t.length).join("|"),Kn=new RegExp(`\\b(?:${Gn})\\b`,"gi");function Un(t){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(t);if(!n)return null;let s=n[0],a=n.index+s.length;return t[a]==="\r"&&t[a+1]===`
`?a+2:t[a]===`
`?a+1:a}function qn(t,e){let n=Un(t);if(n===null)return t.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${e}
`;let s=t.slice(0,n),o=t.slice(n).replace(/^\r?\n{0,}/,""),r=s.endsWith(`

`)?"":s.endsWith(`
`)?`
`:`

`;return s+r+e+`
`+o}function ge(t,e){let n=t.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(t.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t.basename))return!0;if(e){let s=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(s&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(s[1]))return!0}return!1}function zn(t){let e=t.match(Kn);return e?[...new Set(e.map(n=>jt[n.toLowerCase()]).filter(Boolean))]:[]}function Xn(t){let e=zn(t);if(e.length===0)return!0;let n=Wn().format("dddd");return e.includes(n)}function Qn(t){let e=t.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return e?e[1].trim():t.trim()}async function ye(t,e,n){let s=window.moment().format("YYYY-MM-DD"),a=`^${s}`;if(n.includes(a))return!1;let r=`- [ ] \u{1F504}Habit - ${Qn(e.basename)} ${s} ${a}`,l=qn(n,r);return await t.vault.modify(e,l),!0}async function it(t,e){let n=e.path;if(!Lt.has(n)){Lt.add(n);try{if(!ge(e))return;if(!Xn(e.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:e.path});return}let s=await t.vault.read(e);if(!ge(e,s))return;await ye(t,e,s)}finally{setTimeout(()=>Lt.delete(n),120)}}}async function we(t,e){let n=await t.vault.read(e);await ye(t,e,n)}var Vn=window.moment,Zn="03 SaveBox/Active",Jn=/(^| )Habit -|^🔁Habit -/i,ta={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Ot={};for(let[t,e]of Object.entries(ta))for(let n of e)Ot[n.toLowerCase()]=t;var ea=Object.keys(Ot).sort((t,e)=>e.length-t.length).join("|"),na=new RegExp(`\\b(?:${ea})\\b`,"gi");function aa(t){let e=t.match(na);return e?[...new Set(e.map(n=>Ot[n.toLowerCase()]).filter(Boolean))]:[]}function sa(t){let e=Vn().format("dddd"),n=aa(t);return{ok:n.length>0&&n.includes(e),todayName:e}}async function be(t,e=Zn){let n=t.vault.getMarkdownFiles().filter(s=>s.path.startsWith(e+"/")).filter(s=>Jn.test(s.basename));for(let s of n){let{ok:a}=sa(s.basename);if(a)try{await it(t,s)}catch{}}}var gt=require("obsidian"),Y=window.moment,oa=t=>Y(t).format("YYYY-MM-DD");function $e(t){let e=Y(t+"-01","YYYY-MM-DD").startOf("month"),n=e.clone().endOf("month");return{start:e,end:n}}function ra(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ia(t,e){let s=new RegExp(`^#{1,6}\\s+${ra(e)}\\s*$`,"gim").exec(t);if(!s)return null;let a=s.index+s[0].length,o=(s[0].match(/^#+/)||["#"])[0].length,r=new RegExp(`^#{1,${o}}\\s+`,"gim");r.lastIndex=a;let l=r.exec(t);return{start:a,end:l?l.index:t.length}}function ca(t){t=String(t).trim();let e=t.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||t.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||t.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||t.match(/📅\s*(\d{4}-\d{2}-\d{2})/);return e?e[1]:null}async function la(t,e){let n=t.vault.getAbstractFileByPath(e.sourcePath);return n instanceof gt.TFile?t.vault.read(n):""}function ua(t){let e=ia(t,"\u270D\uFE0F Log")||{start:0,end:t.length},n=t.slice(e.start,e.end),s=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,a=[],o;for(;o=s.exec(n);){let r=o[1].toLowerCase()==="x",l=o[2],i=ca(l);i&&a.push({date:i,done:r})}return a}function da(t){let e=new Map;for(let n of t)e.set(n.date,e.get(n.date)||!1||n.done);return e}function ha(t){let e={};for(let[s,a]of t){let o=Y(s).format("YYYY-MM");(e[o]||(e[o]=[])).push({date:s,done:a})}return Object.keys(e).sort().slice(-3).reverse().map(s=>{let a=e[s],o=a.length?Math.round(a.filter(r=>r.done).length/a.length*100):0;return{label:Y(s,"YYYY-MM").format("MMM"),pct:o}})}function fa(t,e=90){let n=0,s=Y();for(let a=0;a<e;a++){let o=oa(s);if(t.get(o))n++;else break;s.subtract(1,"day")}return n}function ma(t,e,n){let s=t.createDiv({cls:"habit-monthly-summary"});s.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let a=s.createDiv({cls:"month-bars"});e.forEach(({label:o,pct:r},l)=>{let i=a.createDiv({cls:"month-row"});i.innerHTML=`
      <div class="month-label">${o}</div>
      <div class="bar-track">
        <div class="bar-fill ${l===0?"bar-orange":"bar-purple"}" style="width:${r}%;"></div>
      </div>
      <div class="pct-text">${r}<span class="pct-symbol">%</span></div>
    `})}function Te(t,e,n,s){let a=w=>Y(w).format("YYYY-MM-DD"),o=n.clone().startOf("isoWeek"),r=s.clone().endOf("isoWeek"),l=[...e.keys()].sort(),i=null;for(let w=l.length-1;w>=0;w--){let $=l[w];if(!Y($).isAfter(s)){if(Y($).isBefore(n))break;if(e.get($)){i=$;break}}}let c=t.createDiv({cls:"weekly-streak-wrap"}),u=c.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(w=>u.createDiv({cls:"head",text:w}));let d=c.createDiv({cls:"weekly-streak-grid"}),f=[],b=r.clone().endOf("isoWeek");for(;b.isSameOrAfter(o);){let w=b.clone().startOf("isoWeek");f.push({weekStart:w.clone(),weekEnd:b.clone()}),b.subtract(1,"week")}for(let w of f){let $=w.weekStart.clone();for(let m=0;m<7;m++){let k=a($),T=$.isSameOrAfter(n)&&$.isSameOrBefore(s),h=T?!!e.get(k):!1,y=d.createDiv({cls:"weekly-streak-cell"});T||y.classList.add("pad"),h&&T&&(y.classList.add("hit"),k===i&&y.classList.add("latest-hit")),y.createDiv({cls:"num",text:T?$.format("D"):""}),y.createDiv({cls:"mmm",text:T?$.format("MMM"):""}),y.setAttr("title",T?`${$.format("ddd, DD MMM YYYY")} ${h?"\u2705 Done":"\u274C Missed"}`:""),$.add(1,"day")}}}function pa(t,e,n){let s=t.createDiv({cls:"month-switch"});return e.forEach((a,o)=>{let r=s.createEl("button",{text:a.label,cls:"month-btn"});o===0&&r.classList.add("active"),r.addEventListener("click",()=>{s.querySelectorAll(".month-btn").forEach(l=>l.classList.remove("active")),r.classList.add("active"),n(a.key)})}),s}function ga(t){let e=document.createElement("style");e.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,t.appendChild(e)}async function ke(t,e,n){e.replaceChildren();let s=await la(t,n),a=ua(s),o=da(a),r=ha(o),l=fa(o);ga(e),ma(e,r,l);let c=Array.from(new Set([...o.keys()].map(d=>Y(d).format("YYYY-MM")))).sort().slice(-3).reverse().map(d=>({key:d,label:Y(d,"YYYY-MM").format("MMM")})),u=c[0]?.key;if(pa(e,c,d=>{u=d,e.querySelectorAll(".weekly-streak-wrap").forEach(w=>w.remove());let{start:f,end:b}=$e(d);Te(e,o,f,b)}),u){let{start:d,end:f}=$e(u);Te(e,o,d,f)}}function ya(t,e,n){let s=(()=>{let o=null;return()=>{o&&window.clearTimeout(o),o=window.setTimeout(async()=>{o=null,await ke(t.app,e,n)},120)}})();class a extends gt.MarkdownRenderChild{onload(){this.registerEvent(t.app.vault.on("modify",r=>{r?.path===n.sourcePath&&s()})),this.registerEvent(t.app.metadataCache.on("changed",r=>{r?.path===n.sourcePath&&s()})),this.registerEvent(t.app.metadataCache.on("resolved",()=>s())),this.registerEvent(t.app.workspace.on("editor-change",()=>s()))}}n.addChild(new a(e))}function xe(t){let e=async(n,s,a)=>{await ke(t.app,s,a),ya(t,s,a)};t.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",e),t.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",e)}var yt=require("obsidian");var Yt=class extends yt.SuggestModal{constructor(n){super(n.app);this.plugin=n;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(n){let s=[{label:"Open Today (Daily)",action:async()=>{await rt(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await Pt(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await Dt(this.app)}},{label:"Open This Quarter",action:async()=>{await Ct(this.app)}},{label:"Open This Year",action:async()=>{await Et(this.app)}}],a=n.trim().toLowerCase();return a?s.filter(o=>o.label.toLowerCase().includes(a)):s}renderSuggestion(n,s){s.createDiv({text:n.label})}async onChooseSuggestion(n){await n.action()}};function Fe(t){t.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",n=>{let s=new yt.Menu;s.addItem(a=>a.setTitle("Open Today (Daily)").onClick(async()=>{await rt(t.app)})),s.addItem(a=>a.setTitle("Open This Week (Weekly)").onClick(async()=>{await Pt(t.app)})),s.addItem(a=>a.setTitle("Open This Month (Monthly)").onClick(async()=>{await Dt(t.app)})),s.addItem(a=>a.setTitle("Open This Quarter").onClick(async()=>{await Ct(t.app)})),s.addItem(a=>a.setTitle("Open This Year").onClick(async()=>{await Et(t.app)})),s.showAtMouseEvent(n)}).setAttr("aria-label","WishMap: Periodic Notes"),t.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new Yt(t).open()})}var Ht=require("obsidian");var V=require("obsidian");async function ve(t,e,n){let s=t.vault.getAbstractFileByPath(e);if(!(s instanceof V.TFile))return;let a=await t.vault.read(s),o=a.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/),r=a,l={};if(o){try{l=(0,V.parseYaml)(o[1])??{}}catch{l={}}r=a.slice(o[0].length)}for(let[u,d]of Object.entries(n))d!==void 0&&(l[u]=d);let c=`---
${(0,V.stringifyYaml)(l).trimEnd()}
---
${r}`;c!==a&&await t.vault.modify(s,c)}function Rt(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}function W(t,e){let n=Rt(e.basename);return/^project(\s|:|-|_)/.test(n)}function G(t,e){let n=Rt(e.basename);return/^task(\s|:|-|_)/.test(n)}function I(t,e){let n=Rt(e.basename);return/^goal(\s|:|-|_)/.test(n)}function Ae(t,e){let s=t.metadataCache.getFileCache(e)?.links??[],a=new Set,o=[];for(let r of s){let l=t.metadataCache.getFirstLinkpathDest(r.link,e.path);l instanceof Ht.TFile&&l.extension==="md"&&(a.has(l.path)||(a.add(l.path),o.push(l)))}return o}function Me(t,e){return Ae(t,e).filter(n=>G(t,n))}function wa(t,e){return Ae(t,e).filter(n=>W(t,n))}function _t(t,e){let n=t.metadataCache.getFileCache(e)?.frontmatter??{},s=["duration_hours","durationHours","duration","duration hours"];for(let a of s)if(n[a]!==void 0){let o=(typeof n[a]=="string",Number(n[a]));if(Number.isFinite(o))return o}return 0}async function Se(t,e,n,s){let a=t.metadataCache.getFileCache(e)?.frontmatter?.[n],o=Number(a),r=Math.round(s*10)/10;Number.isFinite(o)&&Math.abs(o-r)<.05||await ve(t,e.path,{[n]:r})}async function ct(t,e){if(!W(t,e))return;let n=Me(t,e),s=0;for(let a of n)s+=_t(t,a);await Se(t,e,"duration_hours",s)}async function Bt(t,e){if(!I(t,e))return;let n=wa(t,e),s=Me(t,e),a=0;for(let o of n)a+=_t(t,o);for(let o of s)a+=_t(t,o);await Se(t,e,"duration_hours",a)}function Nt(t,e,n){let s=[],a=t.metadataCache.resolvedLinks,o=new Set;for(let[r,l]of Object.entries(a)){if(!l[e.path])continue;let i=t.vault.getAbstractFileByPath(r);i instanceof Ht.TFile&&i.extension==="md"&&n(t,i)&&(o.has(i.path)||(o.add(i.path),s.push(i)))}return s}function _(t,e){if(W(t,e))return[e,...Nt(t,e,I)];if(G(t,e)){let n=Nt(t,e,W),s=Nt(t,e,I);return[...n,...s]}return I(t,e)?[e]:[]}var Pe=require("obsidian");function Wt(t){let{app:e}=t;console.log("[WishMap] rollup auto: wiring listeners");let n=new Map;function s(o){let r=o.path,l=n.get(r);l&&window.clearTimeout(l);let i=window.setTimeout(async()=>{if(n.delete(r),W(e,o)){await ct(e,o);for(let c of _(e,o).filter(u=>I(e,u)))await Bt(e,c)}else I(e,o)&&await Bt(e,o)},300);n.set(r,i)}function a(o){if(o instanceof Pe.TFile&&o.extension==="md"){console.log("[WishMap] rollup auto: file change",o.path);for(let r of _(e,o))s(r)}}t.registerEvent(e.metadataCache.on("changed",a)),t.registerEvent(e.vault.on("modify",a)),t.registerEvent(e.vault.on("create",a)),t.registerEvent(e.vault.on("rename",a)),t.registerEvent(e.vault.on("delete",a)),t.addCommand({id:"wishmap-rollup-current",name:"Recompute duration for current note",checkCallback:o=>{let r=e.workspace.getActiveFile();return!r||r.extension!=="md"?!1:(o||s(r),!0)}}),e.workspace.onLayoutReady(()=>{let o=e.vault.getMarkdownFiles();for(let r of o)for(let l of _(e,r))s(l)})}var R=require("obsidian"),wt="03 SaveBox/Active",ba=["duration_hours","durationHours","duration","duration hours"],$a=2;function z(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}var $t=t=>/^area(\s|:|-|_)/.test(z(t.basename)),lt=t=>/^wish(\s|:|-|_)/.test(z(t.basename)),ut=t=>/^goal(\s|:|-|_)/.test(z(t.basename)),X=t=>/^project(\s|:|-|_)/.test(z(t.basename)),et=t=>/^task(\s|:|-|_)/.test(z(t.basename)),dt=t=>/^habit(\s|:|-|_)/.test(z(t.basename)),ht=t=>/^note(\s|:|-|_)/.test(z(t.basename)),Ta=t=>t.path===wt||t.path.startsWith(wt+"/"),F=t=>t.vault.getMarkdownFiles().filter(Ta),p=(t,e)=>t.basename.localeCompare(e.basename),K=(t,e)=>t.metadataCache.getFileCache(e),It=(t,e)=>K(t,e)?.frontmatter??{};function ka(t){let e=Number(String(t??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(e)?e:NaN}function N(t,e){for(let n of ba)if(It(t,e)[n]!==void 0){let s=ka(It(t,e)[n]);if(Number.isFinite(s))return s}return NaN}function xa(t,e){let n=new Set;for(let a of K(t,e)?.tags??[])n.add(String(a?.tag??a).replace(/^#/,""));let s=It(t,e).tags;return Array.isArray(s)?s.forEach(a=>a&&n.add(String(a).replace(/^#/,""))):s&&n.add(String(s).replace(/^#/,"")),Array.from(n)}var g=(t,e)=>{let n=xa(t,e);return n.length?" "+n.map(s=>`#${s}`).join(" "):""},bt=t=>Number(t.toFixed($a)),S=t=>`${bt(t)} ${bt(t)===1?"hr":"hrs"}`,P=t=>`<span class="duration-chip">${t}</span>`,x=(t,e)=>e?`<span class="grey-link">~~${t}~~ \u2705</span>`:t;function H(t,e){let n=e.split(`
`).map(s=>s?`> ${s}`:">").join(`
`);return`> [!wishmap]+ ${t}
>
${n}
`}function De(){return`
.duration-chip{display:inline-block;padding:0 6px;border-radius:12px;line-height:1.6;font-size:0.9em;background-color:var(--interactive-accent-hover);color:var(--background-primary);}
.grey-link a{color:var(--text-faint)!important;}
.callout[data-callout="wishmap"] .callout-icon{display:none;} /* hide icon */
`}function Ce(t,e){let n=K(t,e)?.links??[],s=new Set,a=[];for(let o of n){let r=t.metadataCache.getFirstLinkpathDest(o.link,e.path);r instanceof R.TFile&&r.extension==="md"&&!s.has(r.path)&&(s.add(r.path),a.push(r))}return a}var M=(t,e,n)=>Ce(t,e).some(s=>s.path===n.path)||Ce(t,n).some(s=>s.path===e.path),Fa=(t,e)=>F(t).filter(lt).filter(n=>M(t,e,n)),Le=(t,e)=>F(t).filter(ut).filter(n=>M(t,e,n)),Z=(t,e)=>F(t).filter(X).filter(n=>M(t,e,n)),U=(t,e)=>F(t).filter(et).filter(n=>M(t,e,n)),Tt=(t,e)=>F(t).filter(dt).filter(n=>M(t,e,n)),va=(t,e)=>F(t).filter(ht).filter(n=>M(t,e,n)),je=(t,e)=>F(t).filter(ht).filter(n=>M(t,e,n)),Gt=(t,e)=>F(t).filter(ht).filter(n=>M(t,e,n)),kt=(t,e)=>F(t).filter(ht).filter(n=>M(t,e,n)),q=(t,e)=>F(t).filter(ht).filter(n=>M(t,e,n)),Aa=(t,e)=>F(t).filter(X).filter(n=>M(t,e,n)),Ma=(t,e)=>F(t).filter(et).filter(n=>M(t,e,n)),Sa=(t,e)=>F(t).filter(dt).filter(n=>M(t,e,n)),Pa=(t,e)=>F(t).filter(X).filter(n=>M(t,e,n)),Da=(t,e)=>F(t).filter(et).filter(n=>M(t,e,n)),Ca=(t,e)=>F(t).filter(dt).filter(n=>M(t,e,n)),Ea=(t,e)=>F(t).filter(et).filter(n=>M(t,e,n)),La=(t,e)=>F(t).filter(dt).filter(n=>M(t,e,n));function J(t,e){let n=U(t,e).map(o=>({d:N(t,o),done:A(t,o)})).filter(o=>Number.isFinite(o.d)&&o.d>0),s=n.reduce((o,r)=>o+r.d,0),a=n.filter(o=>o.done).reduce((o,r)=>o+r.d,0);return s<=0?{total:null,pct:null}:{total:bt(s),pct:Math.round(a/s*100)}}var tt=(t,e)=>U(t,e).length>0&&U(t,e).every(n=>A(t,n));function Oe(t,e){let n=Z(t,e),s=0,a=0,o=!1;for(let r of n){let{total:l,pct:i}=J(t,r);Number.isFinite(l)&&l>0&&(o=!0,s+=l,i!=null&&(a+=l*(i/100)))}return!o||s<=0?{total:null,pct:null}:{total:bt(s),pct:Math.round(a/s*100)}}var Ye=(t,e)=>Z(t,e).length>0&&Z(t,e).every(n=>tt(t,n));function A(t,e){let s=(K(t,e)?.listItems??[]).find(a=>a&&"task"in a);return String(s?.task??"").toLowerCase()==="x"}function Kt(t,e){let n=new Set,s=[];s.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let a of Fa(t,e).sort(p))if(!n.has(a.path)){n.add(a.path),s.push(`  - [[${a.path}|${a.basename}]]${g(t,a)}`);for(let o of Le(t,a).sort(p)){if(n.has(o.path))continue;n.add(o.path);let{total:r,pct:l}=Oe(t,o),i=Ye(t,o),c=Number.isFinite(r)&&r>0?` ${P(S(r))}`:"",u=l!=null&&l>0&&l<100?` ${l}%`:"",d=`[[${o.path}|${o.basename}]]${c}${u}${g(t,o)}`;s.push(`    - ${x(d,i)}`);for(let f of Z(t,o).sort(p)){if(n.has(f.path))continue;n.add(f.path);let{total:b,pct:w}=J(t,f),$=tt(t,f),m=Number.isFinite(b)&&b>0?` ${P(S(b))}`:"",k=w!=null&&w>0&&w<100?` ${w}%`:"",T=`[[${f.path}|${f.basename}]]${m}${k}${g(t,f)}`;s.push(`      - ${x(T,$)}`);for(let h of U(t,f).sort(p)){if(n.has(h.path))continue;n.add(h.path);let y=N(t,h),C=Number.isFinite(y)&&y>0?` ${P(S(y))}`:"",D=`[[${h.path}|${h.basename}]]${C}${g(t,h)}`;s.push(`        - ${x(D,A(t,h))}`)}for(let h of Tt(t,f).sort(p)){if(n.has(h.path))continue;n.add(h.path);let y=`[[${h.path}|${h.basename}]]${g(t,h)}`;s.push(`        - ${x(y,A(t,h))}`)}for(let h of kt(t,f).sort(p))n.has(h.path)||(n.add(h.path),s.push(`        - [[${h.path}|${h.basename}]]${g(t,h)}`))}for(let f of Gt(t,o).sort(p))n.has(f.path)||(n.add(f.path),s.push(`    - [[${f.path}|${f.basename}]]${g(t,f)}`))}for(let o of je(t,a).sort(p))n.has(o.path)||(n.add(o.path),s.push(`  - [[${o.path}|${o.basename}]]${g(t,o)}`))}for(let a of Aa(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let{total:o,pct:r}=J(t,a),l=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${l}${i}${g(t,a)}`,tt(t,a))}`)}for(let a of Ma(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let o=N(t,a),r=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${r}${g(t,a)}`,A(t,a))}`)}for(let a of Sa(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - ${x(`[[${a.path}|${a.basename}]]${g(t,a)}`,A(t,a))}`));for(let a of va(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - [[${a.path}|${a.basename}]]${g(t,a)}`));return H(`${e.basename}`,s.join(`
`))}function Ne(t,e){let n=new Set,s=[];s.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let a of Le(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let{total:o,pct:r}=Oe(t,a),l=Ye(t,a),i=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"",c=r!=null&&r>0&&r<100?` ${r}%`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${i}${c}${g(t,a)}`,l)}`);for(let u of Z(t,a).sort(p)){if(n.has(u.path))continue;n.add(u.path);let{total:d,pct:f}=J(t,u),b=tt(t,u),w=Number.isFinite(d)&&d>0?` ${P(S(d))}`:"",$=f!=null&&f>0&&f<100?` ${f}%`:"";s.push(`    - ${x(`[[${u.path}|${u.basename}]]${w}${$}${g(t,u)}`,b)}`);for(let m of U(t,u).sort(p)){if(n.has(m.path))continue;n.add(m.path);let k=N(t,m),T=Number.isFinite(k)&&k>0?` ${P(S(k))}`:"";s.push(`      - ${x(`[[${m.path}|${m.basename}]]${T}${g(t,m)}`,A(t,m))}`);for(let h of q(t,m).sort(p))n.has(h.path)||(n.add(h.path),s.push(`        - [[${h.path}|${h.basename}]]${g(t,h)}`))}for(let m of Tt(t,u).sort(p))n.has(m.path)||(n.add(m.path),s.push(`      - ${x(`[[${m.path}|${m.basename}]]${g(t,m)}`,A(t,m))}`));for(let m of kt(t,u).sort(p))n.has(m.path)||(n.add(m.path),s.push(`      - [[${m.path}|${m.basename}]]${g(t,m)}`))}for(let u of Gt(t,a).sort(p))n.has(u.path)||(n.add(u.path),s.push(`  - [[${u.path}|${u.basename}]]${g(t,u)}`))}for(let a of Pa(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let{total:o,pct:r}=J(t,a),l=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${l}${i}${g(t,a)}`,tt(t,a))}`)}for(let a of Da(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let o=N(t,a),r=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${r}${g(t,a)}`,A(t,a))}`);for(let l of q(t,a).sort(p))n.has(l.path)||(n.add(l.path),s.push(`    - [[${l.path}|${l.basename}]]${g(t,l)}`))}for(let a of Ca(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - ${x(`[[${a.path}|${a.basename}]]${g(t,a)}`,A(t,a))}`));for(let a of je(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - [[${a.path}|${a.basename}]]${g(t,a)}`));return H(`${e.basename}`,s.join(`
`))}function _e(t,e){let n=new Set,s=[];s.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let a of Z(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let{total:o,pct:r}=J(t,a),l=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"",i=r!=null&&r>0&&r<100?` ${r}%`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${l}${i}${g(t,a)}`,tt(t,a))}`);for(let c of U(t,a).sort(p)){if(n.has(c.path))continue;n.add(c.path);let u=N(t,c),d=Number.isFinite(u)&&u>0?` ${P(S(u))}`:"";s.push(`    - ${x(`[[${c.path}|${c.basename}]]${d}${g(t,c)}`,A(t,c))}`);for(let f of q(t,c).sort(p))n.has(f.path)||(n.add(f.path),s.push(`      - [[${f.path}|${f.basename}]]${g(t,f)}`))}for(let c of Tt(t,a).sort(p))n.has(c.path)||(n.add(c.path),s.push(`    - ${x(`[[${c.path}|${c.basename}]]${g(t,c)}`,A(t,c))}`));for(let c of kt(t,a).sort(p))n.has(c.path)||(n.add(c.path),s.push(`    - [[${c.path}|${c.basename}]]${g(t,c)}`))}for(let a of Ea(t,e).sort(p)){if(n.has(a.path))continue;n.add(a.path);let o=N(t,a),r=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"";s.push(`  - ${x(`[[${a.path}|${a.basename}]]${r}${g(t,a)}`,A(t,a))}`);for(let l of q(t,a).sort(p))n.has(l.path)||(n.add(l.path),s.push(`    - [[${l.path}|${l.basename}]]${g(t,l)}`))}for(let a of La(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - ${x(`[[${a.path}|${a.basename}]]${g(t,a)}`,A(t,a))}`));for(let a of Gt(t,e).sort(p))n.has(a.path)||(n.add(a.path),s.push(`  - [[${a.path}|${a.basename}]]${g(t,a)}`));return H(`${e.basename}`,s.join(`
`))}function He(t,e){let n=[];n.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let s of U(t,e).sort(p)){let a=N(t,s),o=Number.isFinite(a)&&a>0?` ${P(S(a))}`:"";n.push(`  - ${x(`[[${s.path}|${s.basename}]]${o}${g(t,s)}`,A(t,s))}`);for(let r of q(t,s).sort(p))n.push(`    - [[${r.path}|${r.basename}]]${g(t,r)}`)}for(let s of Tt(t,e).sort(p))n.push(`  - ${x(`[[${s.path}|${s.basename}]]${g(t,s)}`,A(t,s))}`);for(let s of kt(t,e).sort(p))n.push(`  - [[${s.path}|${s.basename}]]${g(t,s)}`);return H(`${e.basename}`,n.join(`
`))}function ja(t,e){let n=[],s=N(t,e),a=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"";n.push(`- ${x(`[[${e.path}|${e.basename}]]${a}${g(t,e)}`,A(t,e))}`);for(let o of q(t,e).sort(p))n.push(`  - [[${o.path}|${o.basename}]]${g(t,o)}`);return H(`${e.basename}`,n.join(`
`))}function Ee(t){return $t(t)?0:lt(t)?1:ut(t)?2:X(t)?3:99}function Oa(t,e,n){let s=K(t,e)?.links??[],a=K(t,n)?.links??[],o=s.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,e.path)?.path===n.path),r=a.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,n.path)?.path===e.path);return o||r}function Ya(t,e){let n=h=>(K(t,h)?.links??[]).length>0,s=h=>{for(let[,y]of Object.entries(t.metadataCache.resolvedLinks))if(y[h.path])return!0;return!1},a=h=>!n(h)&&!s(h),o=h=>{let y=Ee(h);return y===0?!1:F(t).filter(D=>Ee(D)<y).some(D=>Oa(t,D,h))},r=h=>!o(h),l=e.filter(lt).sort(p),i=e.filter(ut).sort(p),c=e.filter(X).sort(p),u=e.filter(et).sort(p),d=e.filter(dt).sort(p),f=h=>h.map(y=>`- [[${y.path}|${y.basename}]]`).join(`
`),b=(h,y)=>y.length?H(`${h} (${y.length})`,f(y)):"",w=h=>h.sort(p).map(y=>Na(t,y)).join(`

`),$=(h,y)=>y.length?H(`${h} (${y.length})`,w(y)):"",m=u.filter(h=>a(h)||r(h)),k="";if(m.length){let h=[];for(let y of m.sort(p)){let C=N(t,y),D=Number.isFinite(C)&&C>0?` ${P(S(C))}`:"";h.push(`- ${x(`[[${y.path}|${y.basename}]]${D}${g(t,y)}`,A(t,y))}`);for(let nt of q(t,y).sort(p))h.push(`  - [[${nt.path}|${nt.basename}]]${g(t,nt)}`)}k=H(`\u{1F4CC} Solo Tasks (${m.length})`,h.join(`
`))}let T=[];return T.push($("\u{1F4AD} Unparented Wishes",l.filter(r))),T.push($("\u{1F3AF} Unparented Goals",i.filter(r))),T.push($("\u{1F680} Unparented Projects",c.filter(r))),T.push(k),T.push(b("\u{1F501} Solo Habits",d.filter(h=>a(h)||r(h)))),T.push(b("\u{1F4AD} Standalone Wishes",l.filter(a))),T.push(b("\u{1F3AF} Standalone Goals",i.filter(a))),T.push(b("\u{1F680} Standalone Projects",c.filter(a))),T.filter(Boolean).join(`

`)}function Na(t,e){if($t(e))return Kt(t,e);if(lt(e))return Ne(t,e);if(ut(e))return _e(t,e);if(X(e))return He(t,e);let n=g(t,e);return H(`\u{1F4C4} ${e.basename}`,`- [[${e.path}|${e.basename}]]${n}`)}function Re(t){let e=t.app;t.registerMarkdownCodeBlockProcessor("wishmap",async(n,s,a)=>{s.empty(),s.createEl("style",{text:De()});let o=await Be(e);await R.MarkdownRenderer.render(e,o,s,a.sourcePath,t)}),t.registerMarkdownCodeBlockProcessor("wishmap-local",async(n,s,a)=>{let o=String(n||"").trim().toLowerCase(),r=e.vault.getAbstractFileByPath(a.sourcePath);if(!(r instanceof R.TFile)||r.extension!=="md"){s.setText("No file context");return}s.empty(),s.createEl("style",{text:De()});let l="";o==="project"||!o&&X(r)?l=He(e,r):o==="goal"||!o&&ut(r)?l=_e(e,r):o==="wish"||!o&&lt(r)?l=Ne(e,r):o==="area"||!o&&$t(r)?l=Kt(e,r):o==="task"||!o&&et(r)?l=ja(e,r):l="_Place in an Area, Wish, Goal, Project, or Task note, or pass one of: area | wish | goal | project | task._",await R.MarkdownRenderer.render(e,l,s,a.sourcePath,t)})}async function Be(t){let e=F(t),n=e.filter($t).sort(p),s=[];for(let a of n)s.push(Kt(t,a));return s.push(Ya(t,e)),s.filter(Boolean).join(`

`)}async function We(t){let e=await Be(t),n=(0,R.normalizePath)(`${wt}/_Maps/Area-Maps.md`),s=t.vault.getAbstractFileByPath(n);if(s instanceof R.TFile)await t.vault.read(s)!==e&&await t.vault.modify(s,e);else{try{await t.vault.createFolder(`${wt}/_Maps`)}catch{}await t.vault.create(n,e)}return n}var xt=class extends v.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1}async onload(){console.log("WishMap v0.2 loaded"),Wt(this),console.log("[WishMap] rollup auto: setup called from main"),Re(this),this.addCommand({id:"wishmap-generate-area-maps",name:"Generate Area Maps note",callback:async()=>{let i=await We(this.app),c=this.app.vault.getAbstractFileByPath(i);c&&this.app.workspace.getLeaf(!0).openFile(c)}}),this.addCommand({id:"wishmap-print-note",name:"Print (Export to PDF)",callback:()=>{this.app.commands.executeCommandById?.("markdown:export-pdf")}}),await this.loadSettings();let n=new Map,s=i=>{let c=i.path,u=n.get(c);u&&window.clearTimeout(u);let d=window.setTimeout(async()=>{n.delete(c),await ct(this.app,i)},300);n.set(c,d)};this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof v.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!G(this.app,c))return;let u=_(this.app,c);for(let d of u)s(d)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof v.TFile)||c.extension!=="md"||!G(this.app,c))return;let u=_(this.app,c);for(let d of u)s(d)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await Xt(this.app),new v.Notice("Starter structure created.")}}),Vt(this.app),this.registerEvent(this.app.vault.on("create",async i=>{let c=i instanceof v.TFile?i:null;if(!c||c.extension!=="md")return;let d=this.app.metadataCache.getFileCache(c)?.frontmatter;(d&&(d.type==="habit"||d.category==="habit")||/\bhabit\b/i.test(c.basename))&&await we(this.app,c)})),this.registerEvent(this.app.workspace.on("file-open",async i=>{i&&await it(this.app,i)})),ae(this.app),ie(this.app),Fe(this),xe(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await be(this.app),new v.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new v.Notice("No active file.");await se(this.app,i)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new v.Notice("No active file.");await it(this.app,i)}});let a=!1;this.app.workspace.onLayoutReady(()=>{a||(this.ensureTodayDailyOpenOnce(),a=!0)}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{a||(this.ensureTodayDailyOpenOnce(),a=!0)})),console.log("WishMap ready");let o=new Map,r=(i,c=300)=>{let u=i.path,d=o.get(u);d&&window.clearTimeout(d);let f=window.setTimeout(async()=>{o.delete(u),await ct(this.app,i)},c);o.set(u,f)},l=(i,c=1500)=>new Promise(u=>{let d=!1,f=()=>{d||(d=!0,u())},b=this.app.metadataCache.on("changed",w=>{w?.path===i&&(this.app.metadataCache.offref(b),f())});window.setTimeout(()=>{this.app.metadataCache.offref(b),f()},c)});this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof v.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!G(this.app,c))return;await l(c.path,1500);let u=_(this.app,c);for(let d of u)r(d,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof v.TFile)||c.extension!=="md"||!G(this.app,c))return;let u=_(this.app,c);for(let d of u)r(d,200)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;!(c instanceof v.TFile)||c.extension!=="md"||W(this.app,c)&&r(c,200)})),Wt(this)}onunload(){console.log("WishMap unloaded")}async openRouted(n){switch(n.type){case"task":await fe(this.app,n.name??"");break;case"project":await me(this.app,n.name??"");break;case"goal":await pe(this.app,n.name??"");break;case"daily":await rt(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let n=window.moment(),s=n.format("YYYY-MM-DD"),a=n.format("dddd");return`02 Execution/1 Daily/${s} ${a}.md`}async createOrOpenTodayDaily(){let n=(0,v.normalizePath)(this.pathForTodayDaily()),s=this.app.vault.getAbstractFileByPath(n);if(s instanceof v.TFile){await this.app.workspace.getLeaf(!0).openFile(s);return}let o=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),r="";o instanceof v.TFile&&(r=await this.app.vault.read(o),r=r.replace(/{{date}}/g,this.todayISO()));let l=await this.app.vault.create(n,r);await this.app.workspace.getLeaf(!0).openFile(l),console.log("Created today\u2019s daily:",n)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let n=this.todayISO(),s=(0,v.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(s);if(a instanceof v.TFile){await this.app.workspace.getLeaf(!0).openFile(a),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings()}async loadSettings(){let n=await this.loadData();this.data=n??{}}async saveSettings(){await this.saveData(this.data)}};
