/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var Et=Object.defineProperty;var bn=Object.getOwnPropertyDescriptor;var Tn=Object.getOwnPropertyNames;var kn=Object.prototype.hasOwnProperty;var $n=(t,e)=>{for(var n in e)Et(t,n,{get:e[n],enumerable:!0})},xn=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Tn(e))!kn.call(t,r)&&r!==n&&Et(t,r,{get:()=>e[r],enumerable:!(a=bn(e,r))||a.enumerable});return t};var Fn=t=>xn(Et({},"__esModule",{value:!0}),t);var xr={};$n(xr,{default:()=>Ct});module.exports=Fn(xr);var $=require("obsidian");var jt=require("obsidian");var at=require("obsidian");function vn(t,e,n){let a=t.metadataCache.getFileCache(e);if(!a?.headings)return null;let r=d=>d.trim().toLowerCase(),s=r(n),o=a.headings.sort((d,u)=>d.position.start.line-u.position.start.line),l=o.findIndex(d=>r(d.heading)===s);if(l===-1)return null;let i=o[l].position.end.line+1,c=l<o.length-1?o[l+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:i,endLine:c}}async function ie(t,e,n,a){let r=vn(t,e,n);if(!r)return!1;let o=(await t.vault.read(e)).split(`
`),l=Math.min(r.startLine,o.length-1),i=Math.min(r.endLine,o.length-1),c=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let d=l;d<=i;d++){let u=o[d].match(c);if(!u)continue;let y=`- [${u[1]==="x"||u[1]==="X"?"x":" "}] ${a}`;return o[d]!==y&&(o[d]=y,await t.vault.modify(e,o.join(`
`))),!0}return!1}function L(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function An(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function Mn(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function Sn(t=new Date){return t.getFullYear()}function Pn(t=new Date){return Math.floor(t.getMonth()/3)+1}function Dn(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+n)/864e5+1)/7)}function Nt(t,e,n=new Date){let a=L(n),r=t;return r=r.replace(/{{\s*title\s*}}/gi,e),r=r.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,s=>a),r=r.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),r=r.replace(/{{\s*weekday\s*}}/gi,An(n)),r=r.replace(/{{\s*monthShort\s*}}/gi,Mn(n)),r=r.replace(/{{\s*year\s*}}/gi,String(Sn(n))),r=r.replace(/{{\s*isoWeek\s*}}/gi,String(Dn(n))),r=r.replace(/{{\s*quarter\s*}}/gi,String(Pn(n))),r}function Cn(t,e){let n=(0,at.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function gt(t,e){let n=(0,at.normalizePath)(e).split("/"),a="";for(let r of n)a=a?`${a}/${r}`:r,t.vault.getAbstractFileByPath(a)||await t.vault.createFolder(a)}async function E(t,e,n){let a=(0,at.normalizePath)(e);if(!Cn(t,a)){let s=a.split("/").slice(0,-1).join("/");s&&await gt(t,s),await t.vault.create(a,n)}}var yt=require("obsidian");var N="03 SaveBox/Templates",Lt={area:`${N}/Area Template.md`,wish:`${N}/Wish Template.md`,goal:`${N}/Goal Template.md`,project:`${N}/Project Template.md`,task:`${N}/Task Template.md`,habit:`${N}/Habit Template.md`,note:`${N}/Note Template.md`,daily:`${N}/Daily Template.md`,weekly:`${N}/Weekly Template.md`,monthly:`${N}/Monthly Template.md`,quarterly:`${N}/Quarterly Template.md`,yearly:`${N}/Yearly Template.md`},Ot={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function rt(t,e,n,a=new Date){let r=(0,yt.normalizePath)(Lt[e]),s=t.vault.getAbstractFileByPath(r);if(s instanceof yt.TFile){console.log(`[MMOS] Using VAULT template for ${e}: ${r}`);let o=await t.vault.read(s);return Nt(o,n,a)}return console.log(`[MMOS] Using FALLBACK template for ${e}`),Nt(Ot[e],n,a)}var En="03 SaveBox/Templates";async function Nn(t,e){let n=t.vault.getMarkdownFiles().filter(s=>s.path.startsWith(En+"/")),a=s=>s.toLowerCase().trim().replace(/^[^a-z0-9]+/,""),r=n.find(s=>new RegExp(`^${e}(\\s|:|-|_)`,"i").test(a(s.basename)));return r?t.vault.read(r):""}async function le(t,e){let{kind:n,title:a}=e,r=e.path??Ln(n,a),s=r.substring(0,r.lastIndexOf("/"));s&&await gt(t,s);let o;if(n==="note"){if(o=await Nn(t,"note"),!o){let i=r.split("/").pop().replace(/\.md$/i,"");o=`---
created: ${L(new Date)}
status: Active
---
# ${i}
`}}else o=await rt(t,n,a,new Date);let l=await t.vault.create(r,o);return await t.fileManager.processFrontMatter(l,i=>{i.created??(i.created=L(new Date)),n==="task"?(i.status??(i.status="Active"),i.impact??(i.impact="Med"),i.slot??(i.slot="Morning"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(i.status??(i.status="Active"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="area"&&(i.status??(i.status="Active"))}),l}async function de(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of e)await gt(t,n);await E(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await E(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await E(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await E(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await E(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,a]of Object.entries(Lt))await E(t,a,Ot[n]);await E(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${L(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await E(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${L(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await E(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${L(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await E(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${L(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await E(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new jt.Notice("\u2705 MindMap OS: starter structure updated.")}function Ln(t,e){let n=On(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${ce("note")}${n}.md`;default:return`03 SaveBox/Active/${ce(t)}${n}.md`}}function ce(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";case"note":return"\u270F\uFE0FNote - ";default:return""}}function On(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var st=require("obsidian");var jn=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],ue={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - ",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function Yn(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Wn(t,e){let a=new RegExp(`^#{1,6}\\s+${Yn(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,o=new RegExp(`^#{1,${s}}\\s+`,"gim");o.lastIndex=r;let l=o.exec(t);return{start:r,end:l?l.index:t.length}}function Rn(t,e){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=t.slice(e.start,e.end);n.lastIndex=0;let r=n.exec(a);if(!r)return null;let s=e.start+r.index,o=s+r[0].length,l=/\[(x|X)\]/.test(r[0]);return{absStart:s,absEnd:o,line:r[0],checked:l}}async function _n(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(r=>setTimeout(r,40))}}async function Hn(t,e,n,a){await _n(t,e);let r=await t.vault.read(e),s=Wn(r,n);if(!s)return!1;let o=Rn(r,s);if(!o)return!1;let i=`- [${/\[(x|X)\]/.test(o.line)?"x":" "}] ${a}`;if(o.line.trimEnd()===i)return!0;let c=r.slice(0,o.absStart)+i+r.slice(o.absEnd);return c!==r&&await t.vault.modify(e,c),!0}function In(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}function Bn(t){return t instanceof st.TFile&&t.extension.toLowerCase()==="md"}function qn(t){let e=t.match(/^(\w+)\s*(?:[-â€“]\s*|\s+)(.+)$/i);if(!e)return null;let n=e[1].toLowerCase();if(!jn.includes(n))return null;let a=e[2].trim();return{kind:n,title:a}}function Gn(t,e){let n=Un(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${ue.note}${n}.md`;default:return`03 SaveBox/Active/${ue[t]}${n}.md`}}function Un(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function Kn(t,e,n){await t.fileManager.processFrontMatter(e,a=>{a.created??(a.created=L(new Date)),n==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):n==="goal"||n==="project"||n==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):n==="area"&&(a.status??(a.status="Active"))})}function he(t){t.vault.on("create",async e=>{try{if(!Bn(e)||(await t.vault.read(e)).trim().length>0)return;let a=e.basename,r=qn(a);if(!r)return;let{kind:s,title:o}=r,l;s==="note"?(l=await rt(t,"note",o,new Date),l||(l=`---
created: ${L(new Date)}
status: Active
---
# \u270F\uFE0FNote - ${o}
`)):l=await rt(t,s,o,new Date),await t.vault.modify(e,l),await Kn(t,e,s);let i=(0,st.normalizePath)(Gn(s,o));if(i!==e.path&&await t.fileManager.renameFile(e,i),s==="task"||s==="project"||s==="goal"){let c=t.vault.getAbstractFileByPath(i),d=c instanceof st.TFile?c:e,u=In(s),f=d.basename;await Hn(t,d,u,f)}console.log(`[MMOS] wikilink routed \u2192 ${s} | ${o}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var me=require("obsidian");function zn(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Qn(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function pe(t,e){let a=new RegExp(`^#{1,6}\\s+${zn(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,o=new RegExp(`^#{1,${s}}\\s+`,"gim");o.lastIndex=r;let l=o.exec(t);return{start:r,end:l?l.index:t.length}}var fe=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function ge(t,e){let n=t.slice(e.start,e.end);fe.lastIndex=0;let a=fe.exec(n);if(!a)return null;let r=e.start+a.index,s=r+a[0].length,o=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:o}}function ye(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var Xn=2e3;function Vn(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function Jn(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function Zn(t){return/<%[\s\S]*?%>/.test(t)}function ta(t){let e=t?.stat?.ctime??0;return Date.now()-e<Xn}function we(t,e){let n=new Set,a=t.vault.on("modify",c=>{n.has(c.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),r=c=>{let d=t.workspace.getActiveViewOfType(me.MarkdownView),f=!!d&&d.file?.path===c.path&&d?.getMode()!=="preview";return{editor:d?.editor,inEdit:f}},s=async(c,d)=>{n.add(c.path);try{await t.fileManager.processFrontMatter(c,u=>{for(let f of Object.keys(d))u[f]=d[f]})}finally{n.delete(c.path)}},o=async(c,d,u,f,y)=>{let{editor:b,inEdit:T}=r(c);n.add(c.path);try{if(T&&b){let m=b.offsetToPos(u),x=b.offsetToPos(f);await new Promise(requestAnimationFrame),b.replaceRange(y,m,x)}else{let m=d.slice(0,u)+y+d.slice(f);m!==d&&await t.vault.modify(c,m)}}finally{n.delete(c.path)}},i=Qn(async()=>{let c=t.workspace.getActiveFile();if(!c||e?.(c)||Vn(c.path))return;let u=(t.metadataCache.getFileCache(c)??{}).frontmatter??{};if(Jn(u))return;let{editor:f,inEdit:y}=r(c),b=y&&f?f.getValue():await t.vault.read(c);if(!b||Zn(b)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(b)||ta(c)||n.has(c.path))return;let m=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let x of m){let k=pe(b,x.heading);if(!k)continue;let h=ge(b,k);if(!h)continue;let w=typeof u.done=="boolean"?u.done:null,C=typeof u[x.flag]=="boolean"?u[x.flag]:null,D=h.checked;if(C===null){await s(c,{done:!!D,[x.flag]:!!D});return}let nt=w!==null&&w!==C;if(D!==C){await s(c,{done:!!D,[x.flag]:!!D});return}if(nt){let wn=ye(h.line,!!w);await o(c,b,h.absStart,h.absEnd,wn),await s(c,{[x.flag]:!!w});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function be(t,e){let a=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},r=!(typeof a.done=="boolean"&&a.done);await t.fileManager.processFrontMatter(e,l=>{l.done=r});let s=await t.vault.read(e),o=["My Task","My Project","My Goal"];for(let l of o){let i=pe(s,l);if(!i)continue;let c=ge(s,i);if(!c)continue;let d=ye(c.line,r),u=s.slice(0,c.absStart)+d+s.slice(c.absEnd);u!==s&&await t.vault.modify(e,u);break}}var ke=require("obsidian");function ea(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function na(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function aa(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function ra(t){return/<%[\s\S]*?%>/.test(t)}function sa(t,e=1500){let n=t?.stat?.ctime??0;return Date.now()-n<e}function oa(t,e,n,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function ia(t,e){let n=e.map(ea).join("|"),r=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(t);if(!r)return null;let s=r.index+r[0].length,o=(r[0].match(/^#+/)||["#"])[0].length,l=new RegExp(`^#{1,${o}}\\s+`,"gim");l.lastIndex=s;let i=l.exec(t);return{start:s,end:i?i.index:t.length}}var Te=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function ca(t,e){let n=t.slice(e.start,e.end);Te.lastIndex=0;let a=Te.exec(n);if(!a)return null;let r=e.start+a.index,s=r+a[0].length,o=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:s,line:a[0],checked:o}}function la(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}function $e(t,e){let n=new Set,a=i=>{let c=t.workspace.getActiveViewOfType(ke.MarkdownView),u=!!c&&c.file?.path===i.path&&c?.getMode()!=="preview";return{editor:c?.editor,inEdit:u}},r=async(i,c)=>{n.add(i.path);try{await t.fileManager.processFrontMatter(i,d=>{for(let u of Object.keys(c))d[u]=c[u]})}finally{n.delete(i.path)}},s=async(i,c,d,u,f)=>{let{editor:y,inEdit:b}=a(i);n.add(i.path);try{if(b&&y){let T=y.offsetToPos(d),m=y.offsetToPos(u);await new Promise(requestAnimationFrame),y.replaceRange(f,T,m)}else{let T=c.slice(0,d)+f+c.slice(u);T!==c&&await t.vault.modify(i,T)}}finally{n.delete(i.path)}},l=na(async()=>{let i=t.workspace.getActiveFile();if(!i||e?.(i)||aa(i.path)||sa(i)||n.has(i.path))return;let d=(t.metadataCache.getFileCache(i)??{}).frontmatter??{},{editor:u,inEdit:f}=a(i),y=f&&u?u.getValue():await t.vault.read(i);if(!y||ra(y)||!oa(i.path,i.basename,y,d))return;let b=ia(y,["\u270D\uFE0F Log","Log"]);if(!b)return;let T=ca(y,b),m=typeof d.done=="boolean"?d.done:null,x=typeof d._habit_sync_state=="boolean"?d._habit_sync_state:null;if(!T&&m===null)return;if(x===null){T?await r(i,{done:!!T.checked,_habit_sync_state:!!T.checked}):m!==null&&await r(i,{_habit_sync_state:!!m});return}let k=T?T.checked:null,h=m!==null&&m!==x;if(k!==null&&k!==x){await r(i,{done:!!k,_habit_sync_state:!!k});return}if(h&&T){let C=la(T.line,!!m);await s(i,y,T.absStart,T.absEnd,C),await r(i,{_habit_sync_state:!!m});return}},150);t.workspace.on("file-open",()=>l()),t.workspace.on("active-leaf-change",()=>l()),t.workspace.on("layout-change",()=>l()),t.workspace.on("editor-change",()=>l()),t.metadataCache.on("changed",()=>l()),t.metadataCache.on("resolved",()=>l()),t.vault.on("modify",()=>l()),t.vault.on("rename",()=>l()),t.vault.on("create",()=>l())}var O=require("obsidian");var ve={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"\u270F\uFE0FNote - "},da="03 SaveBox/Templates";function wt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function Ae(t){return t.trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function ua(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),week:a}}async function Me(t,e){let n=(0,O.normalizePath)(e).split("/"),a="";for(let r of n){a=a?`${a}/${r}`:r;try{await t.vault.createFolder(a)}catch{}}}function X(t,e){let n=t.vault.getAbstractFileByPath((0,O.normalizePath)(e));return n instanceof O.TFile?n:null}function ha(t,e){let n=new Date;switch(t){case"daily":return`02 Execution/1 Daily/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}.md`}`;case"weekly":{let{isoYear:a,week:r}=ua(n);return`02 Execution/2 Weekly/${`${a}-W${String(r).padStart(2,"0")}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}.md`}`;case"quarterly":{let a=Math.floor(n.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${n.getFullYear()}-Q${a}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${n.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/\u270F\uFE0FNote - ${wt(e)}.md`;case"area":case"wish":case"goal":case"project":case"task":case"habit":return`03 SaveBox/Active/${ve[t]}${wt(e)}.md`}return`03 SaveBox/Active/${wt(e)}.md`}async function xe(t,e){let n=`${e.charAt(0).toUpperCase()}${e.slice(1)} Template.md`,a=(0,O.normalizePath)(`${da}/${n}`),r=t.vault.getAbstractFileByPath(a);return r instanceof O.TFile?t.vault.read(r):""}async function fa(t,e,n){let a=(0,O.normalizePath)(e),r=a.replace(/\/[^/]+$/,""),s=a.split("/").pop();await Me(t,r);let o=X(t,a);if(o)return o;let l=t.vault.getFiles().find(c=>c.name===s);if(l&&l.path!==a){await t.fileManager.renameFile(l,a);let c=X(t,a);if(c){if(!(await t.vault.read(c)).trim()){let u=await xe(t,n);u&&await t.vault.modify(c,u)}return c}}let i=await xe(t,n);return await t.vault.create(a,i??"")}async function Fe(t,e,n){if(!["task","project","goal","area","wish","habit","note"].includes(n))return e;let a=ve[n],r=e.path.startsWith("03 SaveBox/Active/"),s=e.basename.startsWith(a);if(!r||s)return e;let o=e.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),l=Ae(o||"Untitled"),i=(0,O.normalizePath)(`03 SaveBox/Active/${a}${wt(l)}.md`);if(i===e.path)return e;let c=X(t,i);return c||(await t.fileManager.renameFile(e,i),X(t,i)??e)}function ma(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}async function pa(t,e,n){for(let s=0;s<25&&!t.metadataCache.getFileCache(e)?.headings?.length;s++)await new Promise(l=>setTimeout(l,40));let a=e.basename,r=ma(n);await ie(t,e,r,a)}async function H(t,e,n){let a=["daily","weekly","monthly","quarterly","yearly"].includes(e),r=(0,O.normalizePath)(ha(e,n));if(a){let u=await fa(t,r,e);return await t.workspace.getLeaf(!1).openFile(u),u}let s=["task","project","goal","area","wish","habit","note"].includes(e)?Ae(n):n,o=X(t,r);if(o){let u=await Fe(t,o,e);return await t.workspace.getLeaf(!1).openFile(u),u}let l=await le(t,{kind:e,title:s}),i=r.replace(/\/[^/]+$/,"");await Me(t,i),l.path!==r&&await t.fileManager.renameFile(l,r);let c=X(t,r)??l;["task","project","goal"].includes(e)&&await pa(t,c,e);let d=await Fe(t,c,e);return await t.workspace.getLeaf(!1).openFile(d),d}var Se=(t,e)=>H(t,"task",e),Pe=(t,e)=>H(t,"project",e),De=(t,e)=>H(t,"goal",e);var ot=t=>H(t,"daily",""),Yt=t=>H(t,"weekly",""),Wt=t=>H(t,"monthly",""),Rt=t=>H(t,"quarterly",""),_t=t=>H(t,"yearly","");var ga=window.moment,Ht=new Set,ya={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},It={};for(let[t,e]of Object.entries(ya))for(let n of e)It[n.toLowerCase()]=t;var wa=Object.keys(It).sort((t,e)=>e.length-t.length).join("|"),ba=new RegExp(`\\b(?:${wa})\\b`,"gi");function Ta(t){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(t);if(!n)return null;let a=n[0],r=n.index+a.length;return t[r]==="\r"&&t[r+1]===`
`?r+2:t[r]===`
`?r+1:r}function ka(t,e){let n=Ta(t);if(n===null)return t.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${e}
`;let a=t.slice(0,n),s=t.slice(n).replace(/^\r?\n{0,}/,""),o=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+o+e+`
`+s}function Ce(t,e){let n=t.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(t.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t.basename))return!0;if(e){let a=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function $a(t){let e=t.match(ba);return e?[...new Set(e.map(n=>It[n.toLowerCase()]).filter(Boolean))]:[]}function xa(t){let e=$a(t);if(e.length===0)return!0;let n=ga().format("dddd");return e.includes(n)}function Fa(t){let e=t.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return e?e[1].trim():t.trim()}async function Ee(t,e,n){let a=window.moment().format("YYYY-MM-DD"),r=`^${a}`;if(n.includes(r))return!1;let o=`- [ ] \u{1F504}Habit - ${Fa(e.basename)} ${a} ${r}`,l=ka(n,o);return await t.vault.modify(e,l),!0}async function it(t,e){let n=e.path;if(!Ht.has(n)){Ht.add(n);try{if(!Ce(e))return;if(!xa(e.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:e.path});return}let a=await t.vault.read(e);if(!Ce(e,a))return;await Ee(t,e,a)}finally{setTimeout(()=>Ht.delete(n),120)}}}async function Ne(t,e){let n=await t.vault.read(e);await Ee(t,e,n)}var va=window.moment,Aa="03 SaveBox/Active",Ma=/(^| )Habit -|^ðŸ”Habit -/i,Sa={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},Bt={};for(let[t,e]of Object.entries(Sa))for(let n of e)Bt[n.toLowerCase()]=t;var Pa=Object.keys(Bt).sort((t,e)=>e.length-t.length).join("|"),Da=new RegExp(`\\b(?:${Pa})\\b`,"gi");function Ca(t){let e=t.match(Da);return e?[...new Set(e.map(n=>Bt[n.toLowerCase()]).filter(Boolean))]:[]}function Ea(t){let e=va().format("dddd"),n=Ca(t);return{ok:n.length>0&&n.includes(e),todayName:e}}async function Le(t,e=Aa){let n=t.vault.getMarkdownFiles().filter(a=>a.path.startsWith(e+"/")).filter(a=>Ma.test(a.basename));for(let a of n){let{ok:r}=Ea(a.basename);if(r)try{await it(t,a)}catch{}}}var bt=require("obsidian"),j=window.moment,Na=t=>j(t).format("YYYY-MM-DD");function Oe(t){let e=j(t+"-01","YYYY-MM-DD").startOf("month"),n=e.clone().endOf("month");return{start:e,end:n}}function La(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Oa(t,e){let a=new RegExp(`^#{1,6}\\s+${La(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,s=(a[0].match(/^#+/)||["#"])[0].length,o=new RegExp(`^#{1,${s}}\\s+`,"gim");o.lastIndex=r;let l=o.exec(t);return{start:r,end:l?l.index:t.length}}function ja(t){t=String(t).trim();let e=t.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||t.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||t.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||t.match(/ðŸ“…\s*(\d{4}-\d{2}-\d{2})/);return e?e[1]:null}async function Ya(t,e){let n=t.vault.getAbstractFileByPath(e.sourcePath);return n instanceof bt.TFile?t.vault.read(n):""}function Wa(t){let e=Oa(t,"\u270D\uFE0F Log")||{start:0,end:t.length},n=t.slice(e.start,e.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,r=[],s;for(;s=a.exec(n);){let o=s[1].toLowerCase()==="x",l=s[2],i=ja(l);i&&r.push({date:i,done:o})}return r}function Ra(t){let e=new Map;for(let n of t)e.set(n.date,e.get(n.date)||!1||n.done);return e}function _a(t){let e={};for(let[a,r]of t){let s=j(a).format("YYYY-MM");(e[s]||(e[s]=[])).push({date:a,done:r})}return Object.keys(e).sort().slice(-3).reverse().map(a=>{let r=e[a],s=r.length?Math.round(r.filter(o=>o.done).length/r.length*100):0;return{label:j(a,"YYYY-MM").format("MMM"),pct:s}})}function Ha(t,e=90){let n=0,a=j();for(let r=0;r<e;r++){let s=Na(a);if(t.get(s))n++;else break;a.subtract(1,"day")}return n}function Ia(t,e,n){let a=t.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let r=a.createDiv({cls:"month-bars"});e.forEach(({label:s,pct:o},l)=>{let i=r.createDiv({cls:"month-row"});i.innerHTML=`
      <div class="month-label">${s}</div>
      <div class="bar-track">
        <div class="bar-fill ${l===0?"bar-orange":"bar-purple"}" style="width:${o}%;"></div>
      </div>
      <div class="pct-text">${o}<span class="pct-symbol">%</span></div>
    `})}function je(t,e,n,a){let r=b=>j(b).format("YYYY-MM-DD"),s=n.clone().startOf("isoWeek"),o=a.clone().endOf("isoWeek"),l=[...e.keys()].sort(),i=null;for(let b=l.length-1;b>=0;b--){let T=l[b];if(!j(T).isAfter(a)){if(j(T).isBefore(n))break;if(e.get(T)){i=T;break}}}let c=t.createDiv({cls:"weekly-streak-wrap"}),d=c.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(b=>d.createDiv({cls:"head",text:b}));let u=c.createDiv({cls:"weekly-streak-grid"}),f=[],y=o.clone().endOf("isoWeek");for(;y.isSameOrAfter(s);){let b=y.clone().startOf("isoWeek");f.push({weekStart:b.clone(),weekEnd:y.clone()}),y.subtract(1,"week")}for(let b of f){let T=b.weekStart.clone();for(let m=0;m<7;m++){let x=r(T),k=T.isSameOrAfter(n)&&T.isSameOrBefore(a),h=k?!!e.get(x):!1,w=u.createDiv({cls:"weekly-streak-cell"});k||w.classList.add("pad"),h&&k&&(w.classList.add("hit"),x===i&&w.classList.add("latest-hit")),w.createDiv({cls:"num",text:k?T.format("D"):""}),w.createDiv({cls:"mmm",text:k?T.format("MMM"):""}),w.setAttr("title",k?`${T.format("ddd, DD MMM YYYY")} ${h?"\u2705 Done":"\u274C Missed"}`:""),T.add(1,"day")}}}function Ba(t,e,n){let a=t.createDiv({cls:"month-switch"});return e.forEach((r,s)=>{let o=a.createEl("button",{text:r.label,cls:"month-btn"});s===0&&o.classList.add("active"),o.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(l=>l.classList.remove("active")),o.classList.add("active"),n(r.key)})}),a}function qa(t){let e=document.createElement("style");e.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,t.appendChild(e)}async function Ye(t,e,n){e.replaceChildren();let a=await Ya(t,n),r=Wa(a),s=Ra(r),o=_a(s),l=Ha(s);qa(e),Ia(e,o,l);let c=Array.from(new Set([...s.keys()].map(u=>j(u).format("YYYY-MM")))).sort().slice(-3).reverse().map(u=>({key:u,label:j(u,"YYYY-MM").format("MMM")})),d=c[0]?.key;if(Ba(e,c,u=>{d=u,e.querySelectorAll(".weekly-streak-wrap").forEach(b=>b.remove());let{start:f,end:y}=Oe(u);je(e,s,f,y)}),d){let{start:u,end:f}=Oe(d);je(e,s,u,f)}}function Ga(t,e,n){let a=(()=>{let s=null;return()=>{s&&window.clearTimeout(s),s=window.setTimeout(async()=>{s=null,await Ye(t.app,e,n)},120)}})();class r extends bt.MarkdownRenderChild{onload(){this.registerEvent(t.app.vault.on("modify",o=>{o?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("changed",o=>{o?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("resolved",()=>a())),this.registerEvent(t.app.workspace.on("editor-change",()=>a()))}}n.addChild(new r(e))}function We(t){let e=async(n,a,r)=>{await Ye(t.app,a,r),Ga(t,a,r)};t.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",e),t.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",e)}var Tt=require("obsidian");var qt=class extends Tt.SuggestModal{constructor(n){super(n.app);this.plugin=n;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(n){let a=[{label:"Open Today (Daily)",action:async()=>{await ot(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await Yt(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await Wt(this.app)}},{label:"Open This Quarter",action:async()=>{await Rt(this.app)}},{label:"Open This Year",action:async()=>{await _t(this.app)}}],r=n.trim().toLowerCase();return r?a.filter(s=>s.label.toLowerCase().includes(r)):a}renderSuggestion(n,a){a.createDiv({text:n.label})}async onChooseSuggestion(n){await n.action()}};function Re(t){t.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",n=>{let a=new Tt.Menu;a.addItem(r=>r.setTitle("Open Today (Daily)").onClick(async()=>{await ot(t.app)})),a.addItem(r=>r.setTitle("Open This Week (Weekly)").onClick(async()=>{await Yt(t.app)})),a.addItem(r=>r.setTitle("Open This Month (Monthly)").onClick(async()=>{await Wt(t.app)})),a.addItem(r=>r.setTitle("Open This Quarter").onClick(async()=>{await Rt(t.app)})),a.addItem(r=>r.setTitle("Open This Year").onClick(async()=>{await _t(t.app)})),a.showAtMouseEvent(n)}).setAttr("aria-label","WishMap: Periodic Notes"),t.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new qt(t).open()})}var Kt=require("obsidian");var V=require("obsidian");async function _e(t,e,n){let a=t.vault.getAbstractFileByPath(e);if(!(a instanceof V.TFile))return;let r=await t.vault.read(a),s=r.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/),o=r,l={};if(s){try{l=(0,V.parseYaml)(s[1])??{}}catch{l={}}o=r.slice(s[0].length)}for(let[d,u]of Object.entries(n))u!==void 0&&(l[d]=u);let c=`---
${(0,V.stringifyYaml)(l).trimEnd()}
---
${o}`;c!==r&&await t.vault.modify(a,c)}function zt(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}function I(t,e){let n=zt(e.basename);return/^project(\s|:|-|_)/.test(n)}function q(t,e){let n=zt(e.basename);return/^task(\s|:|-|_)/.test(n)}function B(t,e){let n=zt(e.basename);return/^goal(\s|:|-|_)/.test(n)}function He(t,e){let a=t.metadataCache.getFileCache(e)?.links??[],r=new Set,s=[];for(let o of a){let l=t.metadataCache.getFirstLinkpathDest(o.link,e.path);l instanceof Kt.TFile&&l.extension==="md"&&(r.has(l.path)||(r.add(l.path),s.push(l)))}return s}function Ie(t,e){return He(t,e).filter(n=>q(t,n))}function Ua(t,e){return He(t,e).filter(n=>I(t,n))}function Ut(t,e){let n=t.metadataCache.getFileCache(e)?.frontmatter??{},a=["duration_hours","durationHours","duration","duration hours"];for(let r of a)if(n[r]!==void 0){let s=(typeof n[r]=="string",Number(n[r]));if(Number.isFinite(s))return s}return 0}async function Be(t,e,n,a){let r=t.metadataCache.getFileCache(e)?.frontmatter?.[n],s=Number(r),o=Math.round(a*10)/10;Number.isFinite(s)&&Math.abs(s-o)<.05||await _e(t,e.path,{[n]:o})}async function ct(t,e){if(!I(t,e))return;let n=Ie(t,e),a=0;for(let r of n)a+=Ut(t,r);await Be(t,e,"duration_hours",a)}async function Qt(t,e){if(!B(t,e))return;let n=Ua(t,e),a=Ie(t,e),r=0;for(let s of n)r+=Ut(t,s);for(let s of a)r+=Ut(t,s);await Be(t,e,"duration_hours",r)}function Gt(t,e,n){let a=[],r=t.metadataCache.resolvedLinks,s=new Set;for(let[o,l]of Object.entries(r)){if(!l[e.path])continue;let i=t.vault.getAbstractFileByPath(o);i instanceof Kt.TFile&&i.extension==="md"&&n(t,i)&&(s.has(i.path)||(s.add(i.path),a.push(i)))}return a}function W(t,e){if(I(t,e))return[e,...Gt(t,e,B)];if(q(t,e)){let n=Gt(t,e,I),a=Gt(t,e,B);return[...n,...a]}return B(t,e)?[e]:[]}var qe=require("obsidian");function Xt(t){let{app:e}=t;console.log("[WishMap] rollup auto: wiring listeners");let n=new Map;function a(s){let o=s.path,l=n.get(o);l&&window.clearTimeout(l);let i=window.setTimeout(async()=>{if(n.delete(o),I(e,s)){await ct(e,s);for(let c of W(e,s).filter(d=>B(e,d)))await Qt(e,c)}else B(e,s)&&await Qt(e,s)},300);n.set(o,i)}function r(s){if(s instanceof qe.TFile&&s.extension==="md"){console.log("[WishMap] rollup auto: file change",s.path);for(let o of W(e,s))a(o)}}t.registerEvent(e.metadataCache.on("changed",r)),t.registerEvent(e.vault.on("modify",r)),t.registerEvent(e.vault.on("create",r)),t.registerEvent(e.vault.on("rename",r)),t.registerEvent(e.vault.on("delete",r)),t.addCommand({id:"wishmap-rollup-current",name:"Recompute duration for current note",checkCallback:s=>{let o=e.workspace.getActiveFile();return!o||o.extension!=="md"?!1:(s||a(o),!0)}}),e.workspace.onLayoutReady(()=>{let s=e.vault.getMarkdownFiles();for(let o of s)for(let l of W(e,o))a(l)})}var _=require("obsidian"),kt="03 SaveBox/Active",Ka=["duration_hours","durationHours","duration","duration hours"],za=2;function z(t){return t.toLowerCase().trim().replace(/^[^a-z0-9]+/,"")}var xt=t=>/^area(\s|:|-|_)/.test(z(t.basename)),lt=t=>/^wish(\s|:|-|_)/.test(z(t.basename)),dt=t=>/^goal(\s|:|-|_)/.test(z(t.basename)),Q=t=>/^project(\s|:|-|_)/.test(z(t.basename)),et=t=>/^task(\s|:|-|_)/.test(z(t.basename)),ut=t=>/^habit(\s|:|-|_)/.test(z(t.basename)),ht=t=>/^note(\s|:|-|_)/.test(z(t.basename)),Qa=t=>t.path===kt||t.path.startsWith(kt+"/"),v=t=>t.vault.getMarkdownFiles().filter(Qa),p=(t,e)=>t.basename.localeCompare(e.basename),G=(t,e)=>t.metadataCache.getFileCache(e),Vt=(t,e)=>G(t,e)?.frontmatter??{};function Xa(t){let e=Number(String(t??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(e)?e:NaN}function Y(t,e){for(let n of Ka)if(Vt(t,e)[n]!==void 0){let a=Xa(Vt(t,e)[n]);if(Number.isFinite(a))return a}return NaN}function Va(t,e){let n=new Set;for(let r of G(t,e)?.tags??[])n.add(String(r?.tag??r).replace(/^#/,""));let a=Vt(t,e).tags;return Array.isArray(a)?a.forEach(r=>r&&n.add(String(r).replace(/^#/,""))):a&&n.add(String(a).replace(/^#/,"")),Array.from(n)}var g=(t,e)=>{let n=Va(t,e);return n.length?" "+n.map(a=>`#${a}`).join(" "):""},$t=t=>Number(t.toFixed(za)),S=t=>`${$t(t)} ${$t(t)===1?"hr":"hrs"}`,P=t=>`<span class="duration-chip">${t}</span>`,F=(t,e)=>e?`<span class="grey-link">~~${t}~~ \u2705</span>`:t;function R(t,e){let n=e.split(`
`).map(a=>a?`> ${a}`:">").join(`
`);return`> [!wishmap]+ ${t}
>
${n}
`}function Ge(){return`
.duration-chip{display:inline-block;padding:0 6px;border-radius:12px;line-height:1.6;font-size:0.9em;background-color:var(--interactive-accent-hover);color:var(--background-primary);}
.grey-link a{color:var(--text-faint)!important;}
.callout[data-callout="wishmap"] .callout-icon{display:none;} /* hide icon */
`}function Ue(t,e){let n=G(t,e)?.links??[],a=new Set,r=[];for(let s of n){let o=t.metadataCache.getFirstLinkpathDest(s.link,e.path);o instanceof _.TFile&&o.extension==="md"&&!a.has(o.path)&&(a.add(o.path),r.push(o))}return r}var M=(t,e,n)=>Ue(t,e).some(a=>a.path===n.path)||Ue(t,n).some(a=>a.path===e.path),Ja=(t,e)=>v(t).filter(lt).filter(n=>M(t,e,n)),ze=(t,e)=>v(t).filter(dt).filter(n=>M(t,e,n)),J=(t,e)=>v(t).filter(Q).filter(n=>M(t,e,n)),U=(t,e)=>v(t).filter(et).filter(n=>M(t,e,n)),Ft=(t,e)=>v(t).filter(ut).filter(n=>M(t,e,n)),Za=(t,e)=>v(t).filter(ht).filter(n=>M(t,e,n)),Qe=(t,e)=>v(t).filter(ht).filter(n=>M(t,e,n)),Jt=(t,e)=>v(t).filter(ht).filter(n=>M(t,e,n)),vt=(t,e)=>v(t).filter(ht).filter(n=>M(t,e,n)),K=(t,e)=>v(t).filter(ht).filter(n=>M(t,e,n)),tr=(t,e)=>v(t).filter(Q).filter(n=>M(t,e,n)),er=(t,e)=>v(t).filter(et).filter(n=>M(t,e,n)),nr=(t,e)=>v(t).filter(ut).filter(n=>M(t,e,n)),ar=(t,e)=>v(t).filter(Q).filter(n=>M(t,e,n)),rr=(t,e)=>v(t).filter(et).filter(n=>M(t,e,n)),sr=(t,e)=>v(t).filter(ut).filter(n=>M(t,e,n)),or=(t,e)=>v(t).filter(et).filter(n=>M(t,e,n)),ir=(t,e)=>v(t).filter(ut).filter(n=>M(t,e,n));function Z(t,e){let n=U(t,e).map(s=>({d:Y(t,s),done:A(t,s)})).filter(s=>Number.isFinite(s.d)&&s.d>0),a=n.reduce((s,o)=>s+o.d,0),r=n.filter(s=>s.done).reduce((s,o)=>s+o.d,0);return a<=0?{total:null,pct:null}:{total:$t(a),pct:Math.round(r/a*100)}}var tt=(t,e)=>U(t,e).length>0&&U(t,e).every(n=>A(t,n));function Xe(t,e){let n=J(t,e),a=0,r=0,s=!1;for(let o of n){let{total:l,pct:i}=Z(t,o);Number.isFinite(l)&&l>0&&(s=!0,a+=l,i!=null&&(r+=l*(i/100)))}return!s||a<=0?{total:null,pct:null}:{total:$t(a),pct:Math.round(r/a*100)}}var Ve=(t,e)=>J(t,e).length>0&&J(t,e).every(n=>tt(t,n));function A(t,e){let a=(G(t,e)?.listItems??[]).find(r=>r&&"task"in r);return String(a?.task??"").toLowerCase()==="x"}function Zt(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let r of Ja(t,e).sort(p))if(!n.has(r.path)){n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${g(t,r)}`);for(let s of ze(t,r).sort(p)){if(n.has(s.path))continue;n.add(s.path);let{total:o,pct:l}=Xe(t,s),i=Ve(t,s),c=Number.isFinite(o)&&o>0?` ${P(S(o))}`:"",d=l!=null&&l>0&&l<100?` ${l}%`:"",u=`[[${s.path}|${s.basename}]]${c}${d}${g(t,s)}`;a.push(`    - ${F(u,i)}`);for(let f of J(t,s).sort(p)){if(n.has(f.path))continue;n.add(f.path);let{total:y,pct:b}=Z(t,f),T=tt(t,f),m=Number.isFinite(y)&&y>0?` ${P(S(y))}`:"",x=b!=null&&b>0&&b<100?` ${b}%`:"",k=`[[${f.path}|${f.basename}]]${m}${x}${g(t,f)}`;a.push(`      - ${F(k,T)}`);for(let h of U(t,f).sort(p)){if(n.has(h.path))continue;n.add(h.path);let w=Y(t,h),C=Number.isFinite(w)&&w>0?` ${P(S(w))}`:"",D=`[[${h.path}|${h.basename}]]${C}${g(t,h)}`;a.push(`        - ${F(D,A(t,h))}`)}for(let h of Ft(t,f).sort(p)){if(n.has(h.path))continue;n.add(h.path);let w=`[[${h.path}|${h.basename}]]${g(t,h)}`;a.push(`        - ${F(w,A(t,h))}`)}for(let h of vt(t,f).sort(p))n.has(h.path)||(n.add(h.path),a.push(`        - [[${h.path}|${h.basename}]]${g(t,h)}`))}for(let f of Jt(t,s).sort(p))n.has(f.path)||(n.add(f.path),a.push(`    - [[${f.path}|${f.basename}]]${g(t,f)}`))}for(let s of Qe(t,r).sort(p))n.has(s.path)||(n.add(s.path),a.push(`  - [[${s.path}|${s.basename}]]${g(t,s)}`))}for(let r of tr(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:o}=Z(t,r),l=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"",i=o!=null&&o>0&&o<100?` ${o}%`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${l}${i}${g(t,r)}`,tt(t,r))}`)}for(let r of er(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let s=Y(t,r),o=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${o}${g(t,r)}`,A(t,r))}`)}for(let r of nr(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - ${F(`[[${r.path}|${r.basename}]]${g(t,r)}`,A(t,r))}`));for(let r of Za(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${g(t,r)}`));return R(`${e.basename}`,a.join(`
`))}function Je(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let r of ze(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:o}=Xe(t,r),l=Ve(t,r),i=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"",c=o!=null&&o>0&&o<100?` ${o}%`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${i}${c}${g(t,r)}`,l)}`);for(let d of J(t,r).sort(p)){if(n.has(d.path))continue;n.add(d.path);let{total:u,pct:f}=Z(t,d),y=tt(t,d),b=Number.isFinite(u)&&u>0?` ${P(S(u))}`:"",T=f!=null&&f>0&&f<100?` ${f}%`:"";a.push(`    - ${F(`[[${d.path}|${d.basename}]]${b}${T}${g(t,d)}`,y)}`);for(let m of U(t,d).sort(p)){if(n.has(m.path))continue;n.add(m.path);let x=Y(t,m),k=Number.isFinite(x)&&x>0?` ${P(S(x))}`:"";a.push(`      - ${F(`[[${m.path}|${m.basename}]]${k}${g(t,m)}`,A(t,m))}`);for(let h of K(t,m).sort(p))n.has(h.path)||(n.add(h.path),a.push(`        - [[${h.path}|${h.basename}]]${g(t,h)}`))}for(let m of Ft(t,d).sort(p))n.has(m.path)||(n.add(m.path),a.push(`      - ${F(`[[${m.path}|${m.basename}]]${g(t,m)}`,A(t,m))}`));for(let m of vt(t,d).sort(p))n.has(m.path)||(n.add(m.path),a.push(`      - [[${m.path}|${m.basename}]]${g(t,m)}`))}for(let d of Jt(t,r).sort(p))n.has(d.path)||(n.add(d.path),a.push(`  - [[${d.path}|${d.basename}]]${g(t,d)}`))}for(let r of ar(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:o}=Z(t,r),l=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"",i=o!=null&&o>0&&o<100?` ${o}%`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${l}${i}${g(t,r)}`,tt(t,r))}`)}for(let r of rr(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let s=Y(t,r),o=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${o}${g(t,r)}`,A(t,r))}`);for(let l of K(t,r).sort(p))n.has(l.path)||(n.add(l.path),a.push(`    - [[${l.path}|${l.basename}]]${g(t,l)}`))}for(let r of sr(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - ${F(`[[${r.path}|${r.basename}]]${g(t,r)}`,A(t,r))}`));for(let r of Qe(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${g(t,r)}`));return R(`${e.basename}`,a.join(`
`))}function Ze(t,e){let n=new Set,a=[];a.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let r of J(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let{total:s,pct:o}=Z(t,r),l=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"",i=o!=null&&o>0&&o<100?` ${o}%`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${l}${i}${g(t,r)}`,tt(t,r))}`);for(let c of U(t,r).sort(p)){if(n.has(c.path))continue;n.add(c.path);let d=Y(t,c),u=Number.isFinite(d)&&d>0?` ${P(S(d))}`:"";a.push(`    - ${F(`[[${c.path}|${c.basename}]]${u}${g(t,c)}`,A(t,c))}`);for(let f of K(t,c).sort(p))n.has(f.path)||(n.add(f.path),a.push(`      - [[${f.path}|${f.basename}]]${g(t,f)}`))}for(let c of Ft(t,r).sort(p))n.has(c.path)||(n.add(c.path),a.push(`    - ${F(`[[${c.path}|${c.basename}]]${g(t,c)}`,A(t,c))}`));for(let c of vt(t,r).sort(p))n.has(c.path)||(n.add(c.path),a.push(`    - [[${c.path}|${c.basename}]]${g(t,c)}`))}for(let r of or(t,e).sort(p)){if(n.has(r.path))continue;n.add(r.path);let s=Y(t,r),o=Number.isFinite(s)&&s>0?` ${P(S(s))}`:"";a.push(`  - ${F(`[[${r.path}|${r.basename}]]${o}${g(t,r)}`,A(t,r))}`);for(let l of K(t,r).sort(p))n.has(l.path)||(n.add(l.path),a.push(`    - [[${l.path}|${l.basename}]]${g(t,l)}`))}for(let r of ir(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - ${F(`[[${r.path}|${r.basename}]]${g(t,r)}`,A(t,r))}`));for(let r of Jt(t,e).sort(p))n.has(r.path)||(n.add(r.path),a.push(`  - [[${r.path}|${r.basename}]]${g(t,r)}`));return R(`${e.basename}`,a.join(`
`))}function tn(t,e){let n=[];n.push(`- [[${e.path}|${e.basename}]]${g(t,e)}`);for(let a of U(t,e).sort(p)){let r=Y(t,a),s=Number.isFinite(r)&&r>0?` ${P(S(r))}`:"";n.push(`  - ${F(`[[${a.path}|${a.basename}]]${s}${g(t,a)}`,A(t,a))}`);for(let o of K(t,a).sort(p))n.push(`    - [[${o.path}|${o.basename}]]${g(t,o)}`)}for(let a of Ft(t,e).sort(p))n.push(`  - ${F(`[[${a.path}|${a.basename}]]${g(t,a)}`,A(t,a))}`);for(let a of vt(t,e).sort(p))n.push(`  - [[${a.path}|${a.basename}]]${g(t,a)}`);return R(`${e.basename}`,n.join(`
`))}function cr(t,e){let n=[],a=Y(t,e),r=Number.isFinite(a)&&a>0?` ${P(S(a))}`:"";n.push(`- ${F(`[[${e.path}|${e.basename}]]${r}${g(t,e)}`,A(t,e))}`);for(let s of K(t,e).sort(p))n.push(`  - [[${s.path}|${s.basename}]]${g(t,s)}`);return R(`${e.basename}`,n.join(`
`))}function Ke(t){return xt(t)?0:lt(t)?1:dt(t)?2:Q(t)?3:99}function lr(t,e,n){let a=G(t,e)?.links??[],r=G(t,n)?.links??[],s=a.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,e.path)?.path===n.path),o=r.some(l=>t.metadataCache.getFirstLinkpathDest(l.link,n.path)?.path===e.path);return s||o}function dr(t,e){let n=h=>(G(t,h)?.links??[]).length>0,a=h=>{for(let[,w]of Object.entries(t.metadataCache.resolvedLinks))if(w[h.path])return!0;return!1},r=h=>!n(h)&&!a(h),s=h=>{let w=Ke(h);return w===0?!1:v(t).filter(D=>Ke(D)<w).some(D=>lr(t,D,h))},o=h=>!s(h),l=e.filter(lt).sort(p),i=e.filter(dt).sort(p),c=e.filter(Q).sort(p),d=e.filter(et).sort(p),u=e.filter(ut).sort(p),f=h=>h.map(w=>`- [[${w.path}|${w.basename}]]`).join(`
`),y=(h,w)=>w.length?R(`${h} (${w.length})`,f(w)):"",b=h=>h.sort(p).map(w=>ur(t,w)).join(`

`),T=(h,w)=>w.length?R(`${h} (${w.length})`,b(w)):"",m=d.filter(h=>r(h)||o(h)),x="";if(m.length){let h=[];for(let w of m.sort(p)){let C=Y(t,w),D=Number.isFinite(C)&&C>0?` ${P(S(C))}`:"";h.push(`- ${F(`[[${w.path}|${w.basename}]]${D}${g(t,w)}`,A(t,w))}`);for(let nt of K(t,w).sort(p))h.push(`  - [[${nt.path}|${nt.basename}]]${g(t,nt)}`)}x=R(`\u{1F4CC} Solo Tasks (${m.length})`,h.join(`
`))}let k=[];return k.push(T("\u{1F4AD} Unparented Wishes",l.filter(o))),k.push(T("\u{1F3AF} Unparented Goals",i.filter(o))),k.push(T("\u{1F680} Unparented Projects",c.filter(o))),k.push(x),k.push(y("\u{1F501} Solo Habits",u.filter(h=>r(h)||o(h)))),k.push(y("\u{1F4AD} Standalone Wishes",l.filter(r))),k.push(y("\u{1F3AF} Standalone Goals",i.filter(r))),k.push(y("\u{1F680} Standalone Projects",c.filter(r))),k.filter(Boolean).join(`

`)}function ur(t,e){if(xt(e))return Zt(t,e);if(lt(e))return Je(t,e);if(dt(e))return Ze(t,e);if(Q(e))return tn(t,e);let n=g(t,e);return R(`\u{1F4C4} ${e.basename}`,`- [[${e.path}|${e.basename}]]${n}`)}function en(t){let e=t.app;t.registerMarkdownCodeBlockProcessor("wishmap",async(n,a,r)=>{a.empty(),a.createEl("style",{text:Ge()});let s=await nn(e);await _.MarkdownRenderer.render(e,s,a,r.sourcePath,t)}),t.registerMarkdownCodeBlockProcessor("wishmap-local",async(n,a,r)=>{let s=String(n||"").trim().toLowerCase(),o=e.vault.getAbstractFileByPath(r.sourcePath);if(!(o instanceof _.TFile)||o.extension!=="md"){a.setText("No file context");return}a.empty(),a.createEl("style",{text:Ge()});let l="";s==="project"||!s&&Q(o)?l=tn(e,o):s==="goal"||!s&&dt(o)?l=Ze(e,o):s==="wish"||!s&&lt(o)?l=Je(e,o):s==="area"||!s&&xt(o)?l=Zt(e,o):s==="task"||!s&&et(o)?l=cr(e,o):l="_Place in an Area, Wish, Goal, Project, or Task note, or pass one of: area | wish | goal | project | task._",await _.MarkdownRenderer.render(e,l,a,r.sourcePath,t)})}async function nn(t){let e=v(t),n=e.filter(xt).sort(p),a=[];for(let r of n)a.push(Zt(t,r));return a.push(dr(t,e)),a.filter(Boolean).join(`

`)}async function an(t){let e=await nn(t),n=(0,_.normalizePath)(`${kt}/_Maps/Area-Maps.md`),a=t.vault.getAbstractFileByPath(n);if(a instanceof _.TFile)await t.vault.read(a)!==e&&await t.vault.modify(a,e);else{try{await t.vault.createFolder(`${kt}/_Maps`)}catch{}await t.vault.create(n,e)}return n}var Dt=require("obsidian");var At=class{constructor(){this.data={nodes:new Map,byType:{area:new Set,wish:new Set,goal:new Set,project:new Set,task:new Set},childrenOf:new Map,observersOf:new Map,unscheduled:{goal:0,project:0,task:0},ready:!1}}reset(){this.data.nodes.clear(),Object.keys(this.data.byType).forEach(e=>this.data.byType[e].clear()),this.data.childrenOf.clear(),this.data.observersOf.clear(),this.data.unscheduled={goal:0,project:0,task:0},this.data.ready=!1}get(){return this.data}markReady(){this.data.ready=!0}isReady(){return this.data.ready}upsertNode(e){this.data.nodes.set(e.path,e),e.type&&this.data.byType[e.type].add(e.path)}removeNode(e){let n=this.data.nodes.get(e);n?.type&&this.data.byType[n.type].delete(e),this.data.nodes.delete(e),this.data.childrenOf.delete(e),this.data.observersOf.delete(e);for(let a of this.data.childrenOf.values())a.delete(e);for(let a of this.data.observersOf.values())a.delete(e)}setPrimaryEdge(e,n){for(let[a,r]of this.data.childrenOf)r.delete(e);n&&(this.data.childrenOf.has(n)||this.data.childrenOf.set(n,new Set),this.data.childrenOf.get(n).add(e))}setObserverEdges(e,n){for(let[a,r]of this.data.observersOf)n.has(a)||r.delete(e);for(let a of n)this.data.observersOf.has(a)||this.data.observersOf.set(a,new Set),this.data.observersOf.get(a).add(e)}getNode(e){return this.data.nodes.get(e)}getByType(e){return[...this.data.byType[e]].map(n=>this.data.nodes.get(n)).filter(Boolean)}getUnscheduledCounts(){return{...this.data.unscheduled}}setUnscheduledCounts(e){this.data.unscheduled=e}};var ft={YEAR:/#year\/(\d{4})/i,QUARTER:/#quarter\/(\d{4}-Q[1-4])/i,MONTH:/#month\/(\d{4})-(\d{2})/i,WEEK:/#week\/(\d{4})-W(\d{2})/i,DUE:/#due\/(\d{4})-(\d{2})-(\d{2})/i};function te(t){let e={},n=t.match(ft.YEAR);n&&(e.year=n[1]);let a=t.match(ft.QUARTER);a&&(e.quarter=a[1]);let r=t.match(ft.MONTH);r&&(e.month=`${r[1]}-${r[2].padStart(2,"0")}`);let s=t.match(ft.WEEK);s&&(e.week=`${s[1]}-W${s[2].padStart(2,"0")}`);let o=t.match(ft.DUE);return o&&(e.due=`${o[1]}-${o[2].padStart(2,"0")}-${o[3].padStart(2,"0")}`),mt(e)}function rn(t){return t?te(t):{}}function sn(t){let e=mt(t),n=[];return e.year&&n.push(`#year/${e.year}`),e.quarter&&n.push(`#quarter/${e.quarter}`),e.month&&n.push(`#month/${e.month}`),e.week&&n.push(`#week/${e.week}`),e.due&&n.push(`#due/${e.due}`),`<!-- wishmap: ${n.join(" ")} -->`}function mt(t){let e={};if(t.year&&/^\d{4}$/.test(t.year)&&(e.year=t.year),t.quarter&&/^\d{4}-Q[1-4]$/.test(t.quarter)&&(e.quarter=t.quarter),t.month&&/^\d{4}-\d{1,2}$/.test(t.month)){let[n,a]=t.month.split("-").map(Number);a>=1&&a<=12&&(e.month=`${n}-${String(a).padStart(2,"0")}`)}if(t.week&&/^\d{4}-W\d{1,2}$/.test(t.week)){let[n,a]=t.week.replace("W","").split("-").map(Number);a>=1&&a<=53&&(e.week=`${n}-W${String(a).padStart(2,"0")}`)}if(t.due&&/^\d{4}-\d{1,2}-\d{1,2}$/.test(t.due)){let[n,a,r]=t.due.split("-").map(Number);a>=1&&a<=12&&r>=1&&r<=31&&(e.due=`${n}-${String(a).padStart(2,"0")}-${String(r).padStart(2,"0")}`)}return e}function ee(t){let e={due:mt({due:t}).due};if(!e.due)return e;let[n,a,r]=e.due.split("-").map(Number);return e.year=String(n),e.month=`${n}-${String(a).padStart(2,"0")}`,e.quarter=`${n}-Q${Math.floor((a-1)/3)+1}`,e.week=`${n}-W${String(fr(new Date(n,a-1,r))).padStart(2,"0")}`,e}function on(t,e){let n=["due","week","month","quarter","year"];for(let a of n){let r=t[a],s=e[a];if(!r&&!s)continue;if(r&&!s)return-1;if(!r&&s)return 1;let o=hr(a,r,s);if(o!==0)return o}return 0}function hr(t,e,n){switch(t){case"due":case"week":case"month":return e<n?-1:e>n?1:0;case"quarter":{let[a,r]=e.split("-Q").map(Number),[s,o]=n.split("-Q").map(Number);return a!==s?a<s?-1:1:r<o?-1:r>o?1:0}case"year":{let a=Number(e),r=Number(n);return a<r?-1:a>r?1:0}default:return 0}}function fr(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7)}function mr(t){let e=t.trim().match(/^(?:\p{Emoji_Presentation}|\p{Emoji}\uFE0F)/u);return e?e[0]:void 0}function cn(t){let e=mr(t)||"",n=t.toLowerCase();if(e==="\u{1F331}"||n.startsWith("area "))return"area";if(e==="\u2728"||n.startsWith("wish "))return"wish";if(e==="\u{1F3AF}"||n.startsWith("goal "))return"goal";if(e==="\u{1F680}"||n.startsWith("project "))return"project";if(e==="\u{1F4CC}"||n.startsWith("task "))return"task"}function Mt(t){let e=t.match(/<!--\s*wishmap:\s*([^>]*)-->/i);return e?e[0]:void 0}function ln(t){let e=te(t),n=rn(Mt(t)??"");return{year:n.year??e.year,quarter:n.quarter??e.quarter,month:n.month??e.month,week:n.week??e.week,due:n.due??e.due}}function dn(t){let e=new Set,n=/^(?:Parents?|Parent)\s*:\s*(.*)$/i,a=t.split(/\r?\n/);for(let r of a){let s=r.match(n);if(!s)continue;let o=s[1].match(/\[\[([^\]]+)\]\]/g)||[];for(let l of o){let i=l.slice(2,-2).trim();i&&e.add(i)}}return e}async function un(t,e){let n=new Set,r=(await t.vault.read(e)).match(/\[\[([^\]]+)\]\]/g)||[];for(let s of r){let o=s.slice(2,-2).trim();o&&n.add(o)}return n}async function St(t,e,n){let a=await t.vault.read(e),r=sn(n),s=Mt(a),o=s?a.replace(s,r):a.trimEnd()+`

`+r+`
`;o!==a&&await t.vault.modify(e,o)}async function fn(t,e){let n=t.metadataCache.getFileCache(e)?.frontmatter??{},a={};if(typeof n.done=="boolean"&&(a.done=n.done),typeof n.status=="string"&&(a.status=n.status),typeof n.impact=="string"&&(a.impact=n.impact),hn(n.duration_hours)&&(a.durationHours=Number(n.duration_hours)),hn(n.budget)&&(a.budget=Number(n.budget)),typeof n.due=="string"){let r=pr(n.due);r&&(a.due=r)}return a}function hn(t){return typeof t=="number"||typeof t=="string"&&t.trim()!==""&&!Number.isNaN(Number(t))}function pr(t){let e=t.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(e){let a=Number(e[1]),r=String(Number(e[2])).padStart(2,"0"),s=String(Number(e[3])).padStart(2,"0");return`${a}-${r}-${s}`}let n=new Date(t);if(!Number.isNaN(n.getTime())){let a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${a}-${r}-${s}`}}function mn(){let t=new At,e;return{async init(n){e=n,await this.rescanAll(),t.markReady(),console.debug("[WishMap] indexer ready")},async rescanAll(){t.reset();let n=e.vault.getMarkdownFiles();for(let a of n){let r=await ne(e,a);r&&t.upsertNode(r)}for(let a of t.get().nodes.values())ae(t,a);t.setUnscheduledCounts(Pt(t))},onFileCreate(n){!(n instanceof Dt.TFile)||n.extension!=="md"||ne(e,n).then(a=>{a&&(t.upsertNode(a),ae(t,a),t.setUnscheduledCounts(Pt(t)))})},onFileModify(n){!(n instanceof Dt.TFile)||n.extension!=="md"||ne(e,n).then(a=>{a&&(t.upsertNode(a),ae(t,a),t.setUnscheduledCounts(Pt(t)))})},onFileDelete(n){n instanceof Dt.TFile&&(t.removeNode(n.path),t.setUnscheduledCounts(Pt(t)))},getStore(){return t}}}async function ne(t,e){let n=e.basename,a=cn(n);if(!a)return;let r=e.stat.mtime,s=await t.vault.read(e),o=ln(s),l=Mt(s),i=await fn(t,e),c=dn(s);if(c.size===0){let f=await un(t,e);for(let y of f)c.add(y)}let d=new Set;for(let f of c){let y=t.metadataCache.getFirstLinkpathDest(f,e.path);y&&d.add(y.path)}return{path:e.path,basename:n,type:a,parents:d,primaryParent:void 0,secondaryParents:new Set,tags:o,yaml:i,conflicts:[],serviceLine:l,mtime:r}}function ae(t,e){if(!e||!e.type)return;let n=[];for(let s of e.parents){let o=t.getNode(s);o&&yr(o.type,e.type)&&n.push(o)}if(n.length===0){e.primaryParent=void 0,e.secondaryParents=new Set,t.setPrimaryEdge(e.path,void 0),t.setObserverEdges(e.path,new Set);return}let a=gr(n);e.primaryParent=a?.path;let r=new Set(n.filter(s=>s.path!==e.primaryParent).map(s=>s.path));e.secondaryParents=r,t.setPrimaryEdge(e.path,e.primaryParent),t.setObserverEdges(e.path,r)}function gr(t){if(t.length===0)return;let e=t[0];for(let n=1;n<t.length;n++){let a=t[n],r=on(e.tags,a.tags);(r>0||r===0&&a.mtime<e.mtime)&&(e=a)}return e}function yr(t,e){let n=["area","wish","goal","project","task"];return n.indexOf(t)<n.indexOf(e)}function Pt(t){let e=0,n=0,a=0;for(let r of t.get().nodes.values())r.type==="goal"&&!r.tags.year&&e++,r.type==="project"&&!r.tags.quarter&&n++,r.type==="task"&&!r.yaml?.due&&a++;return{goal:e,project:n,task:a}}function gn(){return{async run(t){for(let e of t.get().nodes.values())await pn(t,e.path)},async onNodeChange(t,e){await pn(t,e)}}}async function pn(t,e){let n=t.getNode(e);if(n){if(n.yaml.due){let a=wr(n);await br(t,n,a),n.primaryParent&&await Tr(t,n.path)}n.primaryParent&&await kr(t,n.primaryParent)}}function wr(t){return ee(t.yaml.due)}async function br(t,e,n){let a=re(e.tags,n);if(se(e.tags,a)){e.tags=a;let r=oe(t,e.path);r&&(await St(window.app,r,e.tags),console.debug("[WishMap] service tags updated",{path:e.path,tags:e.tags}))}}function re(t,e){let n={...t};return n.due=t.due??e.due,n.week=t.week??e.week,n.month=t.month??e.month,n.quarter=t.quarter??e.quarter,n.year=t.year??e.year,mt(n)}function se(t,e){return JSON.stringify(t)!==JSON.stringify(e)}async function Tr(t,e){let n=t.getNode(e);if(!n?.yaml.due)return;let a=ee(n.yaml.due),r=n.primaryParent?t.getNode(n.primaryParent):void 0;for(;r;){let s={};r.tags.year||(s.year=a.year),r.tags.quarter||(s.quarter=a.quarter),r.tags.month||(s.month=a.month),r.tags.week||(s.week=a.week);let o=re(r.tags,s);if(se(r.tags,o)){r.tags=o;let l=oe(t,r.path);l&&await St(window.app,l,r.tags),console.debug("[WishMap] Auto-filled parent from child due",{parent:r.path,tags:r.tags})}r=r.primaryParent?t.getNode(r.primaryParent):void 0}}async function kr(t,e){let n=t.getNode(e);if(!n)return;let a=t.get().childrenOf.get(e);if(a?.size)for(let r of a){let s=t.getNode(r);if(!s)continue;let o={};n.tags.year&&!s.tags.year&&(o.year=n.tags.year),n.tags.quarter&&!s.tags.quarter&&(o.quarter=n.tags.quarter),n.tags.month&&!s.tags.month&&(o.month=n.tags.month),n.tags.week&&!s.tags.week&&(o.week=n.tags.week);let l=re(s.tags,o);if(se(s.tags,l)){s.tags=l;let i=oe(t,s.path);i&&await St(window.app,i,s.tags),console.debug("[WishMap] Top-down fill",{child:s.path,tags:s.tags})}}}function oe(t,e){return window.app.vault.getAbstractFileByPath(e)}var pt=require("obsidian");function yn(){let t,e;return{init(n,a){t=n,e=a},onNoteOpen(n){let a=e.getNode(n);if(a){if(a.type==="goal"&&!a.tags.year){new pt.Notice("WishMap: Schedule this goal for a year.");return}if(a.type==="project"&&(a.primaryParent?e.getNode(a.primaryParent):void 0)?.tags.year&&!a.tags.quarter){new pt.Notice("WishMap: Assign a quarter for this project.");return}a.type==="task"&&!a.yaml.due&&($r(e,a).some(o=>!o.tags.year||!o.tags.quarter)?new pt.Notice("WishMap: Set a due date. Parents are unscheduled, we'll fill them automatically."):new pt.Notice("WishMap: Set a due date or week for this task."))}}}}function $r(t,e){let n=[];for(let a of e.parents){let r=t.getNode(a);r&&n.push(r)}return n}var Ct=class extends $.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1;this.indexer=mn();this.inference=gn();this.prompts=yn()}async onload(){console.debug("[WishMap] loading\u2026"),await this.indexer.init(this.app),this.store=this.indexer.getStore(),await this.inference.run(this.store),this.prompts.init(this.app,this.store),this.registerEvent(this.app.vault.on("create",async i=>{i instanceof $.TFile&&i.extension==="md"&&(this.indexer.onFileCreate(i),await this.inference.onNodeChange(this.store,i.path))})),this.registerEvent(this.app.vault.on("modify",async i=>{i instanceof $.TFile&&i.extension==="md"&&(this.indexer.onFileModify(i),await this.inference.onNodeChange(this.store,i.path))})),this.registerEvent(this.app.vault.on("delete",i=>{this.indexer.onFileDelete(i)})),this.registerEvent(this.app.workspace.on("file-open",i=>{i&&this.prompts.onNoteOpen(i.path)})),console.log("WishMap v0.2 loaded"),Xt(this),console.log("[WishMap] rollup auto: setup called from main"),en(this),this.addCommand({id:"wishmap-generate-area-maps",name:"Generate Area Maps note",callback:async()=>{let i=await an(this.app),c=this.app.vault.getAbstractFileByPath(i);c&&this.app.workspace.getLeaf(!0).openFile(c)}}),this.addCommand({id:"wishmap-print-note",name:"Print (Export to PDF)",callback:()=>{this.app.commands.executeCommandById?.("markdown:export-pdf")}}),await this.loadSettings();let n=new Map,a=i=>{let c=i.path,d=n.get(c);d&&window.clearTimeout(d);let u=window.setTimeout(async()=>{n.delete(c),await ct(this.app,i)},300);n.set(c,u)};this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof $.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!q(this.app,c))return;let d=W(this.app,c);for(let u of d)a(u)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof $.TFile)||c.extension!=="md"||!q(this.app,c))return;let d=W(this.app,c);for(let u of d)a(u)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await de(this.app),new $.Notice("Starter structure created.")}}),he(this.app),this.registerEvent(this.app.vault.on("create",async i=>{let c=i instanceof $.TFile?i:null;if(!c||c.extension!=="md")return;let u=this.app.metadataCache.getFileCache(c)?.frontmatter;(u&&(u.type==="habit"||u.category==="habit")||/\bhabit\b/i.test(c.basename))&&await Ne(this.app,c)})),this.registerEvent(this.app.workspace.on("file-open",async i=>{i&&await it(this.app,i)})),we(this.app),$e(this.app),Re(this),We(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await Le(this.app),new $.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new $.Notice("No active file.");await be(this.app,i)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let i=this.app.workspace.getActiveFile();if(!i)return new $.Notice("No active file.");await it(this.app,i)}}),this.addCommand({id:"wishmap-rescan",name:"WishMap: Rescan vault",callback:async()=>{new $.Notice("WishMap: Rescanning\u2026"),await this.indexer.rescanAll(),await this.inference.run(this.store),new $.Notice("WishMap: Rescan complete.")}}),this.addCommand({id:"wishmap-rebuild-inference",name:"WishMap: Rebuild inference",callback:async()=>{new $.Notice("WishMap: Rebuilding inference\u2026"),await this.inference.run(this.store),new $.Notice("WishMap: Inference rebuilt.")}});let r=!1;this.app.workspace.onLayoutReady(()=>{r||(this.ensureTodayDailyOpenOnce(),r=!0)}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{r||(this.ensureTodayDailyOpenOnce(),r=!0)})),console.log("WishMap ready");let s=new Map,o=(i,c=300)=>{let d=i.path,u=s.get(d);u&&window.clearTimeout(u);let f=window.setTimeout(async()=>{s.delete(d),await ct(this.app,i)},c);s.set(d,f)},l=(i,c=1500)=>new Promise(d=>{let u=!1,f=()=>{u||(u=!0,d())},y=this.app.metadataCache.on("changed",b=>{b?.path===i&&(this.app.metadataCache.offref(y),f())});window.setTimeout(()=>{this.app.metadataCache.offref(y),f()},c)});this.registerEvent(this.app.vault.on("create",async i=>{let c=i;!(c instanceof $.TFile)||c.extension!=="md"||window.setTimeout(async()=>{if(!q(this.app,c))return;await l(c.path,1500);let d=W(this.app,c);for(let u of d)o(u,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;if(!(c instanceof $.TFile)||c.extension!=="md"||!q(this.app,c))return;let d=W(this.app,c);for(let u of d)o(u,200)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{let c=i;!(c instanceof $.TFile)||c.extension!=="md"||I(this.app,c)&&o(c,200)})),Xt(this)}onunload(){console.log("WishMap unloaded")}async openRouted(n){switch(n.type){case"task":await Se(this.app,n.name??"");break;case"project":await Pe(this.app,n.name??"");break;case"goal":await De(this.app,n.name??"");break;case"daily":await ot(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let n=window.moment(),a=n.format("YYYY-MM-DD"),r=n.format("dddd");return`02 Execution/1 Daily/${a} ${r}.md`}async createOrOpenTodayDaily(){let n=(0,$.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(n);if(a instanceof $.TFile){await this.app.workspace.getLeaf(!0).openFile(a);return}let s=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),o="";s instanceof $.TFile&&(o=await this.app.vault.read(s),o=o.replace(/{{date}}/g,this.todayISO()));let l=await this.app.vault.create(n,o);await this.app.workspace.getLeaf(!0).openFile(l),console.log("Created today\u2019s daily:",n)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let n=this.todayISO(),a=(0,$.normalizePath)(this.pathForTodayDaily()),r=this.app.vault.getAbstractFileByPath(a);if(r instanceof $.TFile){await this.app.workspace.getLeaf(!0).openFile(r),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings()}async loadSettings(){let n=await this.loadData();this.data=n??{}}async saveSettings(){await this.saveData(this.data)}};
